{"version":3,"file":"static/js/322.e84bae3c8d.chunk.js","mappings":"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","sources":["webpack://cli/./src/service/api/topic.api.ts","webpack://cli/./src/service/fetch.ts","webpack://cli/./src/service/module/index.ts","webpack://cli/./src/service/module/topic.service.ts","webpack://cli/./src/core/hook/useTopic.hook.tsx","webpack://cli/./src/template/default/web/components/module/index.tsx","webpack://cli/./src/template/default/web/home/components/topics/index.tsx","webpack://cli/./src/utils/browser.util.ts","webpack://cli/./src/utils/storage.util.ts","webpack://cli/./src/utils/time.util.ts","webpack://cli/./src/utils/dom.util.ts","webpack://cli/./src/utils/url.util.ts"],"sourcesContent":["export class Topic {\r\n  // 主题首页\r\n  public static getTopics = \"/topics\";\r\n  // 主题详情\r\n  public static getTopic(id: string) {\r\n    return `/topic/${id}`;\r\n  }\r\n  // 新建主题\r\n  public static addTopics = \"/topics\";\r\n  // 编辑主题\r\n  public static updateTopics = \"/topics/update\";\r\n  // 收藏主题\r\n  public static topicCollect = \"/topic_collect/collect\";\r\n  // 用户所收藏的主题\r\n  public static topicCollectByLoginname(loginname: string) {\r\n    return `/topic_collect/${loginname}`;\r\n  }\r\n  // 新建评论\r\n  public static addReply(topicId: string) {\r\n    return `/topic/${topicId}/replies`;\r\n  }\r\n  // 评论点赞\r\n  public static replyUps(replyId: string) {\r\n    return `/reply/${replyId}/ups`;\r\n  }\r\n}\r\n","import axios, { AxiosResponse, CancelTokenSource } from \"axios\";\r\nimport Qs from \"qs\";\r\n\r\nexport interface IBaseReponse<T> {\r\n  // 状态码\r\n  success: boolean;\r\n  // 接口数据\r\n  data: T;\r\n}\r\n\r\naxios.defaults.baseURL = \"https://cnodejs.org/api/v1\";\r\n\r\n// 正在进行中的请求列表\r\nconst requestList: string[] = [];\r\n/**\r\n * 阻止重复请求\r\n * @param url -当前请求url地址\r\n * @param cancel -请求中断函数\r\n */\r\nconst stopRepeatRequest = function (\r\n  url: string,\r\n  source: CancelTokenSource\r\n): void {\r\n  for (let i = 0, len = requestList.length; i < len; i++) {\r\n    if (requestList[i] === url) {\r\n      source.cancel();\r\n      return;\r\n    }\r\n  }\r\n  requestList.push(url);\r\n};\r\n\r\n/**\r\n * 允许某个请求可以继续进行\r\n * @param url -请求url地址\r\n */\r\nconst allowRequest = function (url: string): void {\r\n  for (let i = 0, len = requestList.length; i < len; i++) {\r\n    if (requestList[i] === url) {\r\n      requestList.splice(i, 1);\r\n      break;\r\n    }\r\n  }\r\n};\r\n\r\n// 添加请求拦截器\r\naxios.interceptors.request.use(\r\n  (config) => {\r\n    const CancelToken = axios.CancelToken;\r\n    const source = CancelToken.source();\r\n    // 设置token参数\r\n    if (typeof config.headers === \"object\") {\r\n      config.headers.Authorization = `Bearer ${123}`;\r\n    }\r\n    // 取消请求\r\n    config.cancelToken = source.token;\r\n\r\n    stopRepeatRequest(\r\n      `${config.url}?${Qs.stringify(config.params)}&method=${config.method}`,\r\n      source\r\n    );\r\n\r\n    return config;\r\n  },\r\n  (error) => {\r\n    // 对请求错误做些什么\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// 添加响应拦截器\r\naxios.interceptors.response.use(\r\n  (response: AxiosResponse<IBaseReponse<any>>) => {\r\n    // 2xx 范围内的状态码都会触发该函数。\r\n    // 对响应数据做点什么\r\n    const { config, status } = response;\r\n    console.log(config, \"config\");\r\n    if (config) {\r\n      allowRequest(\r\n        `${config.url}?${Qs.stringify(config.params)}&method=${config.method}`\r\n      );\r\n    }\r\n    if (status !== 200) {\r\n      throw new Error(\"请求出现异常, HTTP 状态码不为 200\");\r\n    }\r\n\r\n    return response.data.data;\r\n  },\r\n  (error) => {\r\n    const { config } = error;\r\n    if (config) {\r\n      allowRequest(\r\n        `${config.url}?${Qs.stringify(config.params)}&method=${config.method}`\r\n      );\r\n    }\r\n    // 超出 2xx 范围的状态码都会触发该函数。\r\n    // 对响应错误做点什么\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axios;\r\n","import topicService from \"./topic.service\";\r\n\r\nexport const API = { topicService };\r\n","import { Topic } from \"../api\";\r\nimport { ITopicItem, ITopicDetail } from \"../interface\";\r\nimport axios from \"../fetch\";\r\n\r\nconst topicService = {\r\n  // 主题首页\r\n  getTopics(params: any) {\r\n    return axios.get<ITopicItem[], ITopicItem[]>(Topic.getTopics, { params });\r\n  },\r\n  // 主题详情\r\n  getTopic(id: string) {\r\n    return axios.get<ITopicDetail, ITopicDetail>(Topic.getTopic(id));\r\n  },\r\n};\r\n\r\nexport default topicService;\r\n","import { useState, useCallback } from \"react\";\r\nimport { ITopicItem, API, ITab, ITopicDetail } from \"@service/index\";\r\nimport { browserUtil } from \"@src/utils\";\r\nexport interface ITopicsParams {\r\n  // 页数\r\n  page: number;\r\n  // 主题分类\r\n  tab: ITab;\r\n  // 每一页的主题数量\r\n  limit: number;\r\n  //  当为 false 时，不渲染。默认为 true\r\n  mdrender?: boolean;\r\n  // 是否需要更新\r\n  update?: string | number;\r\n}\r\nexport function useTopic() {\r\n  // 获取所有主题数据\r\n  const [topics, setTopics] = useState<ITopicItem[]>([]);\r\n  // 是否还有数据\r\n  const [isMore, setIsMore] = useState<boolean>(true);\r\n  // 是否处理loading状态\r\n  const [topicsLoading, setTopicsLoading] = useState<boolean>(false);\r\n  // 获取主题列表数据\r\n  const getTopics = useCallback(async (params: ITopicsParams) => {\r\n    setTopicsLoading(true);\r\n    const data = await API.topicService.getTopics(params);\r\n    if (browserUtil.isMobile()) {\r\n      params.page === 1\r\n        ? setTopics(data)\r\n        : setTopics((state) => [...state, ...data]);\r\n    } else {\r\n      setTopics(data);\r\n    }\r\n    setTopicsLoading(false);\r\n    setIsMore(data && data.length ? true : false);\r\n  }, []);\r\n\r\n  const getLabel = useCallback((good: boolean, tab: ITab, top: boolean) => {\r\n    let str = \"\";\r\n    if (good) {\r\n      str = \"精华\";\r\n    } else if (top) {\r\n      str = \"置顶\";\r\n    } else {\r\n      switch (tab) {\r\n        case \"share\":\r\n          str = \"分享\";\r\n          break;\r\n        case \"ask\":\r\n          str = \"问答\";\r\n          break;\r\n        case \"job\":\r\n          str = \"招聘\";\r\n          break;\r\n        default:\r\n          str = \"暂无\";\r\n      }\r\n    }\r\n    return str;\r\n  }, []);\r\n\r\n  // 主题详情数据\r\n  const [topicDetail, setTopicDetail] = useState<ITopicDetail>({\r\n    id: \"\",\r\n    author_id: \"\",\r\n    tab: \"\",\r\n    content: \"\",\r\n    title: \"\",\r\n    last_reply_at: \"\",\r\n    good: false,\r\n    top: false,\r\n    reply_count: 0,\r\n    visit_count: 0,\r\n    create_at: \"\",\r\n    author: {\r\n      loginname: \"\",\r\n      avatar_url: \"\",\r\n    },\r\n    replies: [],\r\n  });\r\n  const [topicDetailLoading, setTopicDetailLoading] = useState(false);\r\n\r\n  const getTopic = useCallback((id: string) => {\r\n    setTopicDetailLoading(true);\r\n    API.topicService\r\n      .getTopic(id)\r\n      .then((data) => {\r\n        setTopicDetail(data);\r\n        setTopicDetailLoading(false);\r\n      })\r\n      .catch(() => {\r\n        setTopicDetailLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  return {\r\n    topics,\r\n    topicsLoading,\r\n    getTopics,\r\n    topicDetail,\r\n    topicDetailLoading,\r\n    getTopic,\r\n    getLabel,\r\n    isMore,\r\n  };\r\n}\r\n","import React, { ReactNode, memo, HtmlHTMLAttributes } from \"react\";\r\nimport \"./index.scss\";\r\ninterface IModule extends Omit<HtmlHTMLAttributes<HTMLDivElement>, \"title\"> {\r\n  title?: ReactNode | string;\r\n  children: ReactNode;\r\n}\r\n\r\nconst Module = memo((props: IModule) => {\r\n  const { title, children, style, className } = props;\r\n  return (\r\n    <div className={`cms-module ${className || \"\"}`} style={style}>\r\n      {title && (\r\n        <div\r\n          className={`cms-module__header ${\r\n            typeof title === \"string\" ? \"is-bold\" : \"\"\r\n          }`}\r\n        >\r\n          {title}\r\n        </div>\r\n      )}\r\n      <div className=\"cms-module__body\">{children}</div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default Module;\r\n","import React, { FC, useEffect, useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport Module from \"../../../components/module\";\r\nimport { timeUtil } from \"@src/utils\";\r\nimport { useTopic } from \"@core/hook\";\r\nimport { Loading } from \"@src/components\";\r\nimport \"./index.scss\";\r\nimport { NoData } from \"@src/components\";\r\nimport { ITab } from \"@src/service\";\r\ninterface ITopics {}\r\n\r\nconst Topics: FC<ITopics> = () => {\r\n  const { getTopics, topics, getLabel, topicsLoading } = useTopic();\r\n  const [tabs] = useState([\r\n    {\r\n      name: \"全部\",\r\n      value: \"\",\r\n    },\r\n    {\r\n      name: \"精华\",\r\n      value: \"good\",\r\n    },\r\n    {\r\n      name: \"分享\",\r\n      value: \"share\",\r\n    },\r\n    {\r\n      name: \"问答\",\r\n      value: \"ask\",\r\n    },\r\n    {\r\n      name: \"招聘\",\r\n      value: \"job\",\r\n    },\r\n    {\r\n      name: \"客户端测试\",\r\n      value: \"dev\",\r\n    },\r\n  ]);\r\n  const [current, setCurrent] = useState<ITab>(\"\");\r\n\r\n  useEffect(() => {\r\n    getTopics({\r\n      page: 1,\r\n      limit: 20,\r\n      tab: current,\r\n    });\r\n  }, [getTopics, current]);\r\n  return (\r\n    <Module\r\n      className=\"cms-topics\"\r\n      title={\r\n        <>\r\n          {tabs.map((item) => (\r\n            <span\r\n              className={`cms-tab__item ${\r\n                current === item.value ? \"is-active\" : \"\"\r\n              }`}\r\n              onClick={() => setCurrent(item.value as ITab)}\r\n              key={item.value}\r\n            >\r\n              {item.name}\r\n            </span>\r\n          ))}\r\n        </>\r\n      }\r\n    >\r\n      {topicsLoading ? <Loading type={1} text=\"加载中...\" /> : null}\r\n      {!topics.length && <NoData />}\r\n\r\n      {topics.map((item) => (\r\n        <div className=\"cms-topics__item\" key={item.id}>\r\n          <Link to={`/user/${item.author_id}`} className=\"user-avatar\">\r\n            <img src={item.author.avatar_url} alt={item.author.loginname} />\r\n          </Link>\r\n          <div className=\"count\">\r\n            <span className=\"replies\">{item.reply_count}</span>\r\n            <span className=\"visits\">{item.visit_count}</span>\r\n          </div>\r\n          {item.good || item.top || !current ? (\r\n            <span\r\n              className={`label ${item.good || item.top ? \"is-active\" : \"\"}`}\r\n            >\r\n              {getLabel(item.good, item.tab, item.top)}\r\n            </span>\r\n          ) : null}\r\n\r\n          <Link className=\"title\" to={`/topic/${item.id}`}>\r\n            {item.title}\r\n          </Link>\r\n          <span className=\"create-time\">\r\n            {timeUtil.timeAgo(item.create_at)}\r\n          </span>\r\n        </div>\r\n      ))}\r\n    </Module>\r\n  );\r\n};\r\n\r\nexport default Topics;\r\n","export const browserUtil = {\r\n  NAV: window.navigator,\r\n  UA() {\r\n    return this.NAV.userAgent.toLowerCase();\r\n  },\r\n  isIpad() {\r\n    return /ipad/i.test(this.UA());\r\n  },\r\n\r\n  isIphone() {\r\n    return /iphone/i.test(this.UA());\r\n  },\r\n  isIpod() {\r\n    return /ipod/i.test(this.UA());\r\n  },\r\n  isIos() {\r\n    return /ipad|iphone|ipod/i.test(this.UA());\r\n  },\r\n  isAndroid() {\r\n    return /android/i.test(this.UA());\r\n  },\r\n  isIe() {\r\n    return /(trident|microsoft)/i.test(this.NAV ? this.NAV.appName : \"\");\r\n  },\r\n  isMobile() {\r\n    return this.isIphone || this.isIos || this.isAndroid;\r\n  },\r\n  isChrome() {\r\n    return /chrome/i.test(this.UA());\r\n  },\r\n  isFirefox() {\r\n    return /firefox/i.test(this.UA());\r\n  },\r\n  isOpera() {\r\n    return /opera/i.test(this.UA());\r\n  },\r\n  isSafari() {\r\n    return /safari/i.test(this.UA());\r\n  },\r\n  isEdge() {\r\n    return /edge/i.test(this.UA());\r\n  },\r\n  isWechat() {\r\n    return /micromessenger/i.test(this.UA());\r\n  },\r\n  isQqbrowser() {\r\n    return /qqbrowser/i.test(this.UA());\r\n  },\r\n  isUcbrowser() {\r\n    return /ucbrowser/i.test(this.UA());\r\n  },\r\n  // 判断video标签在5大主流浏览器能否使用 国内浏览器兼容大\r\n  isVideo() {\r\n    return (\r\n      this.isChrome ||\r\n      this.isFirefox ||\r\n      this.isOpera ||\r\n      this.isSafari ||\r\n      this.isEdge\r\n    );\r\n  },\r\n  //判断浏览器是否支持css var变量\r\n  isCssVar() {\r\n    return window.CSS && window.CSS.supports && window.CSS.supports(\"--a\", \"0\");\r\n  },\r\n};\r\n","export const storageUtil = {\r\n  ls: window.localStorage,\r\n  ss: window.sessionStorage,\r\n\r\n  /*-----------------cookie---------------------*/\r\n  /*设置cookie*/\r\n  setCookie(name: string, value: any, day: any) {\r\n    let setting = arguments[0];\r\n    if (Object.prototype.toString.call(setting).slice(8, -1) === \"Object\") {\r\n      for (let i in setting) {\r\n        let oDate = new Date();\r\n        oDate.setDate(oDate.getDate() + day);\r\n        document.cookie = i + \"=\" + setting[i] + \";expires=\" + oDate;\r\n      }\r\n    } else {\r\n      let oDate = new Date();\r\n      oDate.setDate(oDate.getDate() + day);\r\n      document.cookie = name + \"=\" + value + \";expires=\" + oDate;\r\n    }\r\n  },\r\n\r\n  /*获取cookie*/\r\n  getCookie(name: string) {\r\n    let arr = document.cookie.split(\"; \");\r\n    for (let i = 0; i < arr.length; i++) {\r\n      let arr2 = arr[i].split(\"=\");\r\n      if (arr2[0] === name) {\r\n        return arr2[1];\r\n      }\r\n    }\r\n    return \"\";\r\n  },\r\n\r\n  /*删除cookie*/\r\n  removeCookie(name: string) {\r\n    this.setCookie(name, 1, -1);\r\n  },\r\n\r\n  /*-----------------localStorage---------------------*/\r\n  /*设置localStorage*/\r\n  setLocal(key: string, val: any) {\r\n    let setting = arguments[0];\r\n    if (Object.prototype.toString.call(setting).slice(8, -1) === \"Object\") {\r\n      for (let i in setting) {\r\n        this.ls.setItem(i, JSON.stringify(setting[i]));\r\n      }\r\n    } else {\r\n      this.ls.setItem(key, JSON.stringify(val));\r\n    }\r\n  },\r\n\r\n  /*获取localStorage*/\r\n  getLocal(key: string): string | null {\r\n    if (key) return JSON.parse(this.ls.getItem(key) as string);\r\n    return null;\r\n  },\r\n\r\n  /*移除localStorage*/\r\n  removeLocal(key: any) {\r\n    this.ls.removeItem(key);\r\n  },\r\n\r\n  /*移除所有localStorage*/\r\n  clearLocal() {\r\n    this.ls.clear();\r\n  },\r\n\r\n  /*-----------------sessionStorage---------------------*/\r\n  /*设置sessionStorage*/\r\n  setSession(key: any, val: any) {\r\n    let setting = arguments[0];\r\n    if (Object.prototype.toString.call(setting).slice(8, -1) === \"Object\") {\r\n      for (let i in setting) {\r\n        this.ss.setItem(i, JSON.stringify(setting[i]));\r\n      }\r\n    } else {\r\n      this.ss.setItem(key, JSON.stringify(val));\r\n    }\r\n  },\r\n\r\n  /*获取sessionStorage*/\r\n  getSession(key: any) {\r\n    if (key) return JSON.parse(this.ss.getItem(key) as string);\r\n    return null;\r\n  },\r\n\r\n  /*移除sessionStorage*/\r\n  removeSession(key: any) {\r\n    this.ss.removeItem(key);\r\n  },\r\n\r\n  /*移除所有sessionStorage*/\r\n  clearSession() {\r\n    this.ss.clear();\r\n  },\r\n};\r\n","export const timeUtil = {\r\n  /**\r\n   * 转换时间\r\n   * @param str\r\n   * @returns\r\n   */\r\n  timeAgo(str: string): string {\r\n    if (!str) return \"\";\r\n    var date = new Date(str);\r\n    var time = new Date().getTime() - date.getTime();\r\n    if (time < 0) {\r\n      return \"\";\r\n    } else if (time / 1000 < 30) {\r\n      return \"刚刚\";\r\n    } else if (time / 1000 < 60) {\r\n      return parseInt(time / 1000 + \"\") + \"秒前\";\r\n    } else if (time / 60000 < 60) {\r\n      return parseInt(time / 60000 + \"\") + \"分钟前\";\r\n    } else if (time / 3600000 < 24) {\r\n      return parseInt(time / 3600000 + \"\") + \"小时前\";\r\n    } else if (time / 86400000 < 31) {\r\n      return parseInt(time / 86400000 + \"\") + \"天前\";\r\n    } else if (time / 2592000000 < 12) {\r\n      return parseInt(time / 2592000000 + \"\") + \"月前\";\r\n    } else {\r\n      return parseInt(time / 31536000000 + \"\") + \"年前\";\r\n    }\r\n  },\r\n};\r\n","export const domUtil = {\r\n  /**\r\n   * [获取滚动条当前的位置]\r\n   * @return {[Number]} [scrollTop]\r\n   */\r\n  getScrollTop() {\r\n    let scrollTop = 0;\r\n    if (document.documentElement && document.documentElement.scrollTop) {\r\n      scrollTop = document.documentElement.scrollTop;\r\n    } else if (document.body) {\r\n      scrollTop = document.body.scrollTop;\r\n    }\r\n    return scrollTop;\r\n  },\r\n\r\n  /**\r\n   * [获取当前可视范围的高度]\r\n   * @return {[Number]} [clientHeight]\r\n   */\r\n  getClientHeight() {\r\n    let clientHeight = 0;\r\n    if (document.body.clientHeight && document.documentElement.clientHeight) {\r\n      clientHeight = Math.min(\r\n        document.body.clientHeight,\r\n        document.documentElement.clientHeight\r\n      );\r\n    } else {\r\n      clientHeight = Math.max(\r\n        document.body.clientHeight,\r\n        document.documentElement.clientHeight\r\n      );\r\n    }\r\n    return clientHeight;\r\n  },\r\n\r\n  /**\r\n   * [获取当前可视范围的高度]\r\n   * @return {[Number]} [clientHeight]\r\n   */\r\n  getScrollHeight() {\r\n    return Math.max(\r\n      document.body.scrollHeight,\r\n      document.documentElement.scrollHeight\r\n    );\r\n  },\r\n};\r\n","export const urlUtil = {\r\n  /**\r\n   * 获取参数值\r\n   * @param name\r\n   * @param url\r\n   * @returns {any}\r\n   */\r\n  getUrlParam(name: string, url?: string): string {\r\n    let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n    let result =\r\n      (url || window.location.href).split(\"?\").length > 1 &&\r\n      (url || window.location.href).split(\"?\")[1].match(reg);\r\n    return result ? decodeURIComponent(result[2]) : \"\";\r\n  },\r\n\r\n  /**\r\n   * 修改url参数\r\n   * @param paramName\r\n   * @param replaceWith\r\n   * @param url\r\n   * @returns {string}\r\n   */\r\n  replaceParamVal(paramName: string, replaceWith: string, url: string): string {\r\n    let oUrl = url || window.location.href;\r\n    // eslint-disable-next-line no-eval\r\n    let re = eval(\"/(\" + paramName + \"=)([^&]*)/gi\");\r\n    let nUrl = oUrl.replace(re, paramName + \"=\" + replaceWith);\r\n    return nUrl;\r\n  },\r\n};\r\n"],"names":["Topic","getTopic","id","topicCollectByLoginname","loginname","addReply","topicId","replyUps","replyId","getTopics","addTopics","updateTopics","topicCollect","axios","defaults","baseURL","requestList","allowRequest","url","i","len","length","splice","interceptors","request","use","config","source","CancelToken","headers","Authorization","cancelToken","token","cancel","push","stopRepeatRequest","Qs","params","method","error","Promise","reject","response","status","console","log","Error","data","API","topicService","get","useTopic","topics","setTopics","useState","isMore","setIsMore","topicsLoading","setTopicsLoading","useCallback","async","browserUtil","isMobile","page","state","getLabel","good","tab","top","str","topicDetail","setTopicDetail","author_id","content","title","last_reply_at","reply_count","visit_count","create_at","author","avatar_url","replies","topicDetailLoading","setTopicDetailLoading","then","catch","Module","memo","props","children","style","className","React","Topics","tabs","name","value","current","setCurrent","useEffect","limit","map","item","onClick","key","Loading","type","text","NoData","Link","to","src","alt","timeUtil","timeAgo","NAV","window","navigator","UA","this","userAgent","toLowerCase","isIpad","test","isIphone","isIpod","isIos","isAndroid","isIe","appName","isChrome","isFirefox","isOpera","isSafari","isEdge","isWechat","isQqbrowser","isUcbrowser","isVideo","isCssVar","CSS","supports","localStorage","sessionStorage","date","Date","time","getTime","parseInt","domUtil","getScrollTop","scrollTop","document","documentElement","body","getClientHeight","clientHeight","Math","min","max","getScrollHeight","scrollHeight","urlUtil","getUrlParam","reg","RegExp","result","location","href","split","match","decodeURIComponent","replaceParamVal","paramName","replaceWith","oUrl","re","eval","nUrl","replace"],"sourceRoot":""}