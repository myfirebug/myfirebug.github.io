"use strict";(self.webpackChunkflow_chart=self.webpackChunkflow_chart||[]).push([[737,940,997,469,4,635],{65035:function(e,s,a){a.r(s);var n=a(29439),t=a(72791),c=a(6362),r=a(80542),i=(a(5940),a(1992)),d=a(80184);s.default=function(){var e=(0,t.useContext)(i.DiagramsConfigurationContext),s=(0,t.useState)(!1),a=(0,n.Z)(s,2),l=a[0],u=a[1],o=c.l0.useForm(),x=(0,n.Z)(o,1)[0],m=(0,r.k6)();(0,t.useEffect)((function(){x&&(0,x.setFieldValue)("title",e.data.title)}),[x,e.data.title]);return(0,d.jsxs)("div",{className:"app-diagrams-configuration__header",children:[(0,d.jsxs)("div",{className:"left",children:[(0,d.jsx)(c.u,{placement:"bottom",title:"\u8fd4\u56de",children:(0,d.jsx)("div",{className:"return app-icon",onClick:function(){return m.goBack()},children:"\ue720"})}),(0,d.jsx)("div",{className:"app-icon logo",children:"\ue605"}),(0,d.jsxs)("div",{className:"content",children:[(0,d.jsxs)("div",{className:"top",children:[(0,d.jsx)("span",{className:"title",children:e.data.title}),(0,d.jsx)("span",{className:"app-icon",onClick:function(){return u(!0)},children:"\uec88"})]}),(0,d.jsxs)("ul",{className:"menu",children:[(0,d.jsxs)("li",{className:"menu-item",children:[(0,d.jsx)("div",{className:"name",children:"\u6587\u4ef6"}),(0,d.jsxs)("dl",{className:"sub-menu",children:[(0,d.jsxs)("dd",{onClick:function(){return u(!0)},children:[(0,d.jsx)("span",{className:"app-icon",children:"\uec88"}),(0,d.jsx)("span",{className:"name",children:"\u91cd\u547d\u540d"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue63b"}),(0,d.jsx)("span",{className:"name",children:"\u4fdd\u5b58"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+S"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue765"}),(0,d.jsx)("span",{className:"name",children:"\u514b\u9686"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue8e7"}),(0,d.jsx)("span",{className:"name",children:"\u5173\u95ed"})]})]})]}),(0,d.jsxs)("li",{className:"menu-item",children:[(0,d.jsx)("div",{className:"name",children:"\u7f16\u8f91"}),(0,d.jsxs)("dl",{className:"sub-menu",children:[(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue61e"}),(0,d.jsx)("span",{className:"name",children:"\u64a4\u9500"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+Z"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue60f"}),(0,d.jsx)("span",{className:"name",children:"\u6062\u590d"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+Y"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ueb4b"}),(0,d.jsx)("span",{className:"name",children:"\u526a\u5207"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+X"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue8b0"}),(0,d.jsx)("span",{className:"name",children:"\u62f7\u8d1d"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+C"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue677"}),(0,d.jsx)("span",{className:"name",children:"\u7c98\u8d34"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+V"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue7c3"}),(0,d.jsx)("span",{className:"name",children:"\u5220\u9664"}),(0,d.jsx)("span",{className:"value",children:"Delete"})]})]})]}),(0,d.jsxs)("li",{className:"menu-item",children:[(0,d.jsx)("div",{className:"name",children:"\u9009\u62e9"}),(0,d.jsx)("dl",{className:"sub-menu",children:(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue9c5"}),(0,d.jsx)("span",{className:"name",children:"\u5168\u9009"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+A"})]})})]}),(0,d.jsxs)("li",{className:"menu-item",children:[(0,d.jsx)("div",{className:"name",children:"\u6392\u5217"}),(0,d.jsxs)("dl",{className:"sub-menu",children:[(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue786"}),(0,d.jsx)("span",{className:"name",children:"\u7f6e\u4e8e\u9876\u5c42"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+\u2191"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue742"}),(0,d.jsx)("span",{className:"name",children:"\u7f6e\u4e8e\u5e95\u5c42"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+\u2193"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue7ef"}),(0,d.jsx)("span",{className:"name",children:"\u4e0a\u79fb\u4e00\u5c42"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+Shfit+\u2191"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue7f1"}),(0,d.jsx)("span",{className:"name",children:"\u4e0b\u79fb\u4e00\u5c42"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+Shfit+\u2193"})]})]})]}),(0,d.jsxs)("li",{className:"menu-item",children:[(0,d.jsx)("div",{className:"name",children:"\u5bf9\u9f50"}),(0,d.jsxs)("dl",{className:"sub-menu",children:[(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue602"}),(0,d.jsx)("span",{className:"name",children:"\u5de6\u5bf9\u9f50"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+L"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue65b"}),(0,d.jsx)("span",{className:"name",children:"\u53f3\u5bf9\u9f50"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+R"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue603"}),(0,d.jsx)("span",{className:"name",children:"\u9876\u7aef\u5bf9\u9f50"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+T"})]}),(0,d.jsxs)("dd",{children:[(0,d.jsx)("span",{className:"app-icon",children:"\ue604"}),(0,d.jsx)("span",{className:"name",children:"\u5e95\u7aef\u5bf9\u9f50"}),(0,d.jsx)("span",{className:"value",children:"Ctrl+B"})]})]})]})]})]})]}),(0,d.jsx)("div",{className:"right",children:(0,d.jsx)(c.zx,{type:"primary",children:"\u4fdd\u5b58"})}),(0,d.jsx)(c.u_,{title:"\u4fee\u6539\u6d41\u7a0b\u56fe\u6807\u9898",open:l,onOk:function(){(0,x.validateFields)().then((function(s){e.dispatch({type:"MODIFY_DIAGRAMS_TITLE",title:s.title}),c.yw.success("\u4fee\u6539\u6210\u529f"),u(!1)}))},onCancel:function(){u(!1)},children:(0,d.jsx)(c.l0,{style:{maxWidth:600},autoComplete:"off",form:x,children:(0,d.jsx)(c.l0.Item,{label:"\u6d41\u7a0b\u56fe\u540d\u79f0",name:"title",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6d41\u7a0b\u56fe\u540d\u79f0"}],children:(0,d.jsx)(c.II,{})})})})]})}},99512:function(e,s,a){a.r(s);var n=a(1413),t=a(29439),c=a(72791),r=a(6362),i=a(10133),d=(a(59997),a(28101)),l=a(1992),u=a(80184),o=r.UO.Panel;s.default=function(){var e=(0,c.useContext)(l.DiagramsConfigurationContext),s=(0,c.useState)([]),a=(0,t.Z)(s,2),x=a[0],m=a[1],p=(0,c.useState)([]),h=(0,t.Z)(p,2),j=h[0],f=h[1];(0,c.useEffect)((function(){d.Z.cardList().then((function(e){var s=e.data;m(s.filter((function(e){return"base"===e.type}))),f(s.filter((function(e){return"other"===e.type})))}))}),[]);var N=function(s){e.dispatch({type:"ADD_CARD",data:(0,n.Z)((0,n.Z)({},s),{},{id:(0,i.M8)(),inParams:s.inParams?s.inParams.map((function(e){return(0,n.Z)((0,n.Z)({},e),{},{id:(0,i.M8)()})})):[],ports:s.ports?s.ports.map((function(e){return(0,n.Z)((0,n.Z)({},e),{},{id:(0,i.M8)()})})):[]})})};return(0,u.jsx)("div",{className:"app-diagrams-configuration__menus",children:(0,u.jsx)("div",{className:"body",children:(0,u.jsxs)(r.UO,{defaultActiveKey:["1"],children:[(0,u.jsx)(o,{header:"\u57fa\u7840\u5361\u7247",children:(0,u.jsx)("ul",{className:"menu-list",children:x.map((function(e){return(0,u.jsx)("li",{className:"menu-item",onClick:function(){return N(e)},children:e.title},e.id)}))})},"1"),(0,u.jsx)(o,{header:"\u5176\u4ed6\u5361\u7247",children:(0,u.jsx)("ul",{className:"menu-list",children:j.map((function(e){return(0,u.jsx)("li",{className:"menu-item",onClick:function(){return N(e)},children:e.title},e.id)}))})},"2")]})})})}},76485:function(e,s,a){a.r(s);var n=a(72791),t=a(6362),c=(a(95469),a(25925)),r=a(1992),i=a(59044),d=a(80184);s.default=function(){var e=(0,n.useContext)(r.DiagramsConfigurationContext),s=(0,n.useMemo)((function(){var s=e.data,a=s.cards,n=s.selectedCardsIds,t=[],c=a.findIndex((function(e){return n&&n.includes(e.id)}));return-1!==c&&(t=a[c].inParams),t}),[e]);return(0,d.jsx)("div",{className:"app-diagrams-configuration__settings",children:(0,d.jsx)("div",{className:"body",children:(0,d.jsxs)(t.mQ,{defaultActiveKey:"1",centered:!0,children:[(0,d.jsx)(t.mQ.TabPane,{tab:"\u56fe\u5c42",children:e.data.cards.length?(0,d.jsx)("ul",{className:"card-list",children:e.data.cards.map((function(s){return(0,d.jsxs)("li",{className:"card-item ".concat(e.data.selectedCardsIds&&e.data.selectedCardsIds.includes(s.id)?"is-active":""),children:[(0,d.jsx)("div",{className:"title",children:s.title}),(0,d.jsxs)("div",{className:"operation",children:[(0,d.jsx)(t.u,{title:"\u590d\u5236",children:(0,d.jsx)(i.CopyOutlined,{})}),(0,d.jsx)(t.u,{title:"\u5220\u9664",children:(0,d.jsx)(i.DeleteOutlined,{})})]})]},s.id)}))}):(0,d.jsx)(t.x4,{status:"404",title:"\u6682\u65e0\u6570\u636e",subTitle:"\u70b9\u51fb\u5361\u7247\uff0c\u6dfb\u52a0\u5361\u7247"})},"1"),(0,d.jsx)(t.mQ.TabPane,{tab:"\u914d\u7f6e",children:s.length?(0,d.jsx)(c.Z,{list:s}):(0,d.jsx)(t.x4,{status:"404",title:"\u6682\u65e0\u6570\u636e",subTitle:"\u9700\u8981\u9009\u4e2d\u5361\u7247\u624d\u6709\u6570\u636e\u54e6"})},"2")]})})})}},1992:function(e,s,a){a.r(s),a.d(s,{DiagramsConfigurationContext:function(){return f},default:function(){return N}});var n=a(1413),t=a(29439),c=a(72791),r=a(89982),i=a(65035),d=a(76485),l=a(99512),u=(a(82004),a(25161)),o=a(10133),x=a(30256),m=a(80184),p=function(e){var s=e.s,a=e.e,n=(0,c.useMemo)((function(){var e=Math.abs(a.y-s.y),n=Math.floor(e/3*2),t={x:s.x,y:s.y+4+n},c={x:a.x,y:a.y-4-n};return"M ".concat(s.x," ").concat(s.y,"\n       L ").concat(s.x," ").concat(s.y+4,"\n       C ").concat(t.x," ").concat(t.y," ").concat(c.x," ").concat(c.y," ").concat(a.x," ").concat(a.y-4,"\n       L ").concat(a.x," ").concat(a.y,"\n      ")}),[s,a]);return(0,m.jsx)(r.Path,{data:n,stroke:"#096dd9",strokeWidth:2})},h=a(6362),j=a(39233),f=c.createContext({data:u.initialState,dispatch:function(){}}),N=function(){var e=(0,c.useReducer)(u.diagrams,u.initialState),s=(0,t.Z)(e,2),a=s[0],N=s[1],g=(0,c.useState)({x:0,y:0,width:window.innerWidth-600,height:window.innerHeight-62}),C=(0,t.Z)(g,2),y=C[0],v=C[1],D=(0,c.useState)(),I=(0,t.Z)(D,2),A=I[0],Z=I[1],_=(0,c.useState)({sx:0,sy:0,ex:0,ey:0,distanceCardX:0,distanceCardY:0,distanceStageX:0,distanceStageY:0}),S=(0,t.Z)(_,2),E=S[0],M=S[1],R=(0,c.useState)(""),b=(0,t.Z)(R,2),O=b[0],T=b[1],Y=(0,c.useState)({id:"",source:{cell:"",port:""},target:{cell:"",port:""},data:{source:"",target:""}}),k=(0,t.Z)(Y,2)[1];(0,c.useEffect)((function(){(0,o.Gr)("id")||N({type:"DIAGRAMS",data:{id:null,title:"\u672a\u547d\u540d\u6d41\u7a0b\u56fe",description:"",selectedCardsIds:"",x:0,y:0,cards:[],edges:[]}})}),[]);var w=(0,c.useCallback)((function(e){var s=e.evt,n=s.offsetX,t=s.offsetY,c=e.target.attrs,r=c.type,i=c.cx,d=c.cy,l=c.id,u=c.cardId,x=c.portId,m=c.group;switch(r&&Z(r),r){case"stage":a.selectedCardsIds&&N({type:"SELECTS_CARD",ids:""});break;case"port":T(m),k({id:(0,o.M8)(),source:{cell:u,port:x},target:{cell:"",port:""},data:{source:u,target:""}})}"stage"===r||a.selectedCardsIds&&a.selectedCardsIds.includes(l)||N({type:"SELECTS_CARD",ids:l||u}),M({sx:n,sy:t,ex:n,ey:t,distanceCardX:n-i,distanceCardY:t-d,distanceStageX:n-y.x,distanceStageY:t-y.y})}),[a.selectedCardsIds,y.x,y.y]),G=(0,c.useCallback)((function(e){var s=e.evt,a=s.offsetX,t=s.offsetY;switch(M((function(e){return(0,n.Z)((0,n.Z)({},e),{},{ex:a,ey:t})})),A){case"move":N({type:"MODIFY_CARD",data:{x:a-E.distanceCardX,y:t-E.distanceCardY}});break;case"stage":v((function(e){return(0,n.Z)((0,n.Z)({},e),{},{x:a-E.distanceStageX,y:t-E.distanceStageY})}))}}),[A,E.distanceCardX,E.distanceCardY,E.distanceStageX,E.distanceStageY]),L=(0,c.useCallback)((function(e){var s=e.target.attrs,t=s.cardId,c=s.portId,r=s.group;switch(A){case"stage":N({type:"MODIFY_DIAGRAMS_COORDINATE",coordinate:{x:y.x,y:y.y}});break;case"port":O!==r?k((function(e){var s=(0,n.Z)((0,n.Z)({},e),{},{target:{cell:t,port:c},data:(0,n.Z)((0,n.Z)({},e.data),{},{target:t})});a.edges.length?-1===a.edges.findIndex((function(e){return e.source.cell===s.source.cell&&e.source.port===s.source.port&&e.target.cell===s.target.cell&&e.target.port===s.target.port}))?N({type:"ADD_EDGE",edge:s}):h.yw.error("\u4e0d\u80fd\u8fde\u63a5\u4e00\u6837\u7684\u7ebf"):N({type:"ADD_EDGE",edge:s});return s})):h.yw.error("\u53ea\u80fdinPort\u8fde\u63a5outPort")}Z("")}),[A,y.x,y.y,O,a.edges]),F=(0,c.useMemo)((function(){var e=[];return a.edges&&a.edges.forEach((function(s){var n={id:s.id,target:{x:0,y:0},source:{x:0,y:0}},t=a.cards.find((function(e){return e.id===s.data.source})),c=a.cards.find((function(e){return e.id===s.data.target}));if(t&&c){var r=t.ports.find((function(e){return e.id===s.source.port})),i=c.ports.find((function(e){return e.id===s.target.port}));r&&i&&("left"===r.group?(n.source.x=t.x+j.JX+j.cu/2,n.source.y=t.y+j.Qf+j.eE+j.cu/2):(n.source.x=t.x+t.width-j.JX-j.cu/2,n.source.y=t.y+j.Qf+j.eE+j.cu/2),"left"===i.group?(n.target.x=c.x+j.JX+j.cu/2,n.target.y=c.y+j.Qf+j.eE+j.cu/2):(n.target.x=c.x+c.width-j.JX-j.cu/2,n.target.y=c.y+j.Qf+j.eE+j.cu/2),e.push(n))}})),e}),[a]);return(0,m.jsx)(f.Provider,{value:{dispatch:N,data:a},children:(0,m.jsxs)("div",{className:"app-diagrams-configuration",children:[(0,m.jsx)(i.default,{}),(0,m.jsxs)("div",{className:"app-diagrams-configuration__body",children:[(0,m.jsx)(l.default,{}),(0,m.jsx)("div",{className:"app-diagrams-configuration__container",id:"js_stage",children:(0,m.jsxs)(r.Stage,(0,n.Z)((0,n.Z)({},y),{},{type:"stage",onMouseDown:w,onMouseMove:G,onMouseUp:L,children:[(0,m.jsx)(r.Layer,{children:F.map((function(e){return(0,m.jsx)(p,{s:{x:e.source.x,y:e.source.y},e:{x:e.target.x,y:e.target.y}},e.id)}))}),(0,m.jsx)(r.Layer,{children:a.cards?a.cards.map((function(e){return(0,m.jsx)(x.Z,{config:e,SelectedCardsIds:a.selectedCardsIds},e.id)})):null}),(0,m.jsx)(r.Layer,{children:"port"===A?(0,m.jsx)(p,{s:{x:E.sx-a.x,y:E.sy-a.y},e:{x:E.ex-a.x,y:E.ey-a.y}}):null})]}))}),(0,m.jsx)(d.default,{})]}),(0,m.jsx)("div",{className:"app-diagrams-configuration__footer"})]})})}},25161:function(e,s,a){a.r(s),a.d(s,{diagrams:function(){return l},initialState:function(){return d}});var n=a(93433),t=a(1413),c=a(39233),r=a(6635),i=function(e){var s=c.Qf;return e.ports.some((function(e){return e.visible}))&&(s+=c.cu+c.eE),e.inParams.forEach((function(){s+=c.cu})),s+=c.eE},d={id:null,title:"",description:"",createTime:"",selectedCardsIds:"",x:0,y:0,cards:[],edges:[]},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,s=arguments.length>1?arguments[1]:void 0,a=JSON.parse(JSON.stringify(e));switch(s.type){case r.DIAGRAMS:return(0,t.Z)((0,t.Z)({},s.data),{},{cards:s.data.cards.map((function(e){return(0,t.Z)((0,t.Z)({},e),{},{height:i(e)})}))});case r.MODIFY_DIAGRAMS_TITLE:return(0,t.Z)((0,t.Z)({},a),{},{title:s.title});case r.ADD_CARD:return(0,t.Z)((0,t.Z)({},a),{},{cards:[].concat((0,n.Z)(a.cards),[(0,t.Z)((0,t.Z)({},s.data),{},{x:s.data.x-a.x,y:s.data.y-a.y,height:i(s.data)})]),selectedCardsIds:s.data.id});case r.MODIFY_CARD:return(0,t.Z)((0,t.Z)({},a),{},{cards:a.cards.map((function(e){return a.selectedCardsIds.includes(e.id)?(0,t.Z)((0,t.Z)({},e),s.data):e}))});case r.SELECTS_CARD:return(0,t.Z)((0,t.Z)({},a),{},{selectedCardsIds:s.ids});case r.MODIFY_DIAGRAMS_COORDINATE:return(0,t.Z)((0,t.Z)({},a),s.coordinate);case r.ADD_EDGE:return(0,t.Z)((0,t.Z)({},a),{},{edges:[].concat((0,n.Z)(a.edges),[s.edge])});default:return e}}},6635:function(e,s,a){a.r(s),a.d(s,{ADD_CARD:function(){return r},ADD_EDGE:function(){return l},DIAGRAMS:function(){return n},MODIFY_CARD:function(){return i},MODIFY_DIAGRAMS_COORDINATE:function(){return c},MODIFY_DIAGRAMS_TITLE:function(){return t},SELECTS_CARD:function(){return d}});var n="DIAGRAMS",t="MODIFY_DIAGRAMS_TITLE",c="MODIFY_DIAGRAMS_COORDINATE",r="ADD_CARD",i="MODIFY_CARD",d="SELECTS_CARD",l="ADD_EDGE"},5940:function(e,s,a){a.r(s),s.default={}},59997:function(e,s,a){a.r(s),s.default={}},95469:function(e,s,a){a.r(s),s.default={}},82004:function(e,s,a){a.r(s),s.default={}}}]);