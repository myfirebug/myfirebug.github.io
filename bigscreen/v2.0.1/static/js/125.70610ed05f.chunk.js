"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[125,466,461],{79125:function(e,t,l){l.r(t),l.d(t,{default:function(){return Y}});var n=l(67294),a=l(89250);const r=new class{constructor(){this.moveItem=new Map}set(e,t){this.moveItem.set(e,t)}remove(e){this.moveItem.delete(e)}get(e){return this.moveItem.get(e)}};var c=e=>{let{width:t=0,height:l=0,gap:a=0,column:r=0,row:c=0,x:s=0,y:i=0,style:o,children:m}=e;const d=(0,n.useMemo)((()=>((e,t,l,n,a,r,c)=>({width:e*r+(r-1)*a+"px",height:t*c+(c-1)*a+"px",transform:`translate(${(e+a)*(l-1)}px,${(t+a)*(n-1)}px)`}))(t,l,s,i,a,r,c)),[r,a,l,c,t,s,i]);return n.createElement("div",{className:"cms-drag__moveMask",style:{...d,...o}},m)},s=l(49812);var i=(0,n.memo)((e=>{const{data:t,style:l,groupName:a,onResizeStart:c,onResizeing:s,onResizeEnd:i,onCloseHander:o,children:m}=e,[d,u]=(0,n.useState)(!1),[E,g]=(0,n.useState)(!1),y=(0,n.useMemo)((()=>({gridArea:`${t.y} / ${t.x} / ${t.y+t.row}/ ${t.x+t.column}`,...d?{opacity:0,transform:"translate(-999999999px, -9999999999px)"}:{},...E?{opacity:.5}:{}})),[t.column,t.row,t.x,t.y,d,E]),p=(0,n.useCallback)((e=>{r.set(a,{...t,pageX:e.pageX,pageY:e.pageY}),setTimeout((()=>{u(!0)}),0),g(!1)}),[t,a]),v=(0,n.useCallback)((e=>{u(!1),r.remove(a)}),[a]),h=(0,n.useCallback)((e=>{r.set(a,t),g(!0),null==c||c()}),[t,a,c]),f=(0,n.useCallback)((e=>{e.preventDefault(),null==s||s(e)}),[s]),w=(0,n.useCallback)((e=>{null==i||i(),e.target.style.width="100%",e.target.style.height="100%",g(!1)}),[i]);return n.createElement("div",{className:"cms-drag__preview--item",style:{...y,...l},onDragStart:p,draggable:!0,onDragEnd:v,onMouseDown:h,onMouseMove:f,onMouseUp:w},m,n.createElement("div",{className:"close",onClick:e=>{e.preventDefault(),null==o||o(t.elementId)}}),n.createElement("div",{className:"resize"}))}));var o=(0,n.memo)((e=>{const{groupName:t,column:l,row:a,gap:o,mask:m=!0,field:d="id",onDropHandler:u,datas:E,onResizeEndHandler:g,onCloseHander:y,renderPreview:p}=e,v=(0,n.useRef)(null),[h,f]=(0,n.useState)({width:0,height:0,x:0,y:0}),[w,_]=(0,n.useState)(!1),[N,I]=(0,n.useState)({}),x=(0,n.useCallback)((()=>{var e;if(!v.current)return;const{width:t,height:n,x:r,y:c}=null===(e=v.current)||void 0===e?void 0:e.getBoundingClientRect();f({width:(t-(l-1)*o)/l,height:(n-(a-1)*o)/a,x:r,y:c})}),[l,o,a]);(0,n.useEffect)((()=>{x();const e=new ResizeObserver((e=>{Array.isArray(e)&&e.length&&x()}));return e.observe(v.current),()=>{e.disconnect()}}),[x]);const C=(0,n.useMemo)((()=>{const e=[N.x,N.y,N.x+N.column-1,N.y+N.row-1];return(t=[0,0,l,a])[0]<=(n=e)[0]&&t[1]<=n[1]&&t[2]>=n[2]&&t[3]>=n[3]&&E.every((t=>t[d]===N[d]||!((e,t)=>!(e[2]<=t[0]||t[2]<=e[0]||e[3]<=t[1]||t[3]<=e[1]))([t.x-1,t.y-1,t.x+t.column,t.y+t.row],e)));var t,n}),[l,N,E,d,a]),T=(0,n.useCallback)((e=>parseInt(String((e-h.x)/(h.width+o)))+1),[h.width,h.x,o]),b=(0,n.useCallback)((e=>parseInt(String((e-h.y)/(h.height+o)))+1),[h.height,h.y,o]),k=(0,n.useCallback)((e=>Math.max(1,Math.ceil(e/(h.width+o)))),[h.width,o]),D=(0,n.useCallback)((e=>Math.max(1,Math.ceil(e/(h.height+o)))),[h.height,o]),M=(0,n.useCallback)((e=>{e.preventDefault();const l=r.get(t);l&&I((t=>({...t,...l,x:T(e.pageX),y:b(e.pageY),show:!0}))),console.log("onDragEnter")}),[T,b,t]),S=(0,n.useCallback)((e=>{e.preventDefault();const l=r.get(t);l&&I((t=>({...t,...l,x:T(e.pageX),y:b(e.pageY),show:!0}))),console.log("onDragOver")}),[T,b,t]),L=(0,n.useCallback)((e=>{e.preventDefault(),I((e=>({...e,show:!1,[d]:void 0}))),console.log("onDragLeave")}),[d]),R=(0,n.useCallback)((e=>{const l=r.get(t);e.preventDefault(),I((e=>({...e,show:!1}))),C&&u&&u(!Boolean(l&&l[d]),{...l,...N,[d]:l&&l[d]?l[d]:(0,s.M8)()}),console.log("onDrop")}),[N,d,t,C,u]),H=(0,n.useCallback)((()=>{const e=r.get(t);e&&(_(!1),I((t=>({...t,...e,show:!0}))))}),[t]),A=(0,n.useCallback)((e=>{_(!1),I((t=>({...t,column:k(e.target.offsetWidth),row:D(e.target.offsetHeight)})))}),[k,D]),$=(0,n.useCallback)((()=>{_(!0),I((e=>({...e,show:!1})))}),[]);return(0,n.useEffect)((()=>{const e=r.get(t);w&&C&&((null==e?void 0:e.column)===N.column&&(null==e?void 0:e.row)===N.row||(console.log(e,N,t,"update onResizeEndHandler"),null==g||g(N),_(!1)))}),[g,N,t,w,C]),n.createElement("div",{ref:v,className:"cms-drag__content",onDragEnter:M,onDragOver:S,onDragLeave:L,onDrop:R},n.createElement("div",{className:"cms-drag__content--container",style:{display:"grid",gap:`${o}px`,gridTemplateColumns:`repeat(${l}, ${h.width}px)`,gridTemplateRows:`repeat(${a},  ${h.height}px)`,width:"100%",height:"100%"}},new Array(l*a).fill(null).map(((e,t)=>n.createElement("div",{key:t})))),n.createElement("div",{className:"cms-drag__preview",style:{display:"grid",gap:`${o}px`,gridTemplateColumns:`repeat(${l}, ${h.width}px)`,gridTemplateRows:`repeat(${a},  ${h.height}px)`,width:"100%",height:"100%"}},E.map((e=>n.createElement(i,{key:e[d],data:e,groupName:t,style:{pointerEvents:N.show&&e[d]!==N[d]?"none":"all"},onResizeStart:H,onResizeing:A,onResizeEnd:$,onCloseHander:y},null==p?void 0:p(e)))),m?n.createElement(c,{style:{display:null!=N&&N.show?"flex":"none",background:C?"var(--cms-divider-color)":"var(--cms-color-help)"},width:h.width,height:h.height,gap:o,column:null==N?void 0:N.column,row:null==N?void 0:N.row,x:null==N?void 0:N.x,y:null==N?void 0:N.y},C?"可放置":"不可放置"):null))}));var m={BaseText:e=>{let{data:t,field:l,options:a}=e;return n.createElement("div",{style:(0,s.Wi)(a)},t&&t[l]?t[l]:"文本框")}},d=l(24404),u=l(2639),E=l(48093),g=l(71258),y=l(34002),p=l(83309);var v=e=>{let{name:t,open:l,onClose:a,pageType:r,modifyNameSuccessHander:c}=e;return n.createElement(u.Z,{open:l,onClose:a,onCancel:a,footer:null,title:`修改${p.E0[r]}名称`,destroyOnClose:!0},n.createElement(E.Z,{onFinish:e=>{null==c||c(e.name),d.ZP.success("修改成功"),a()},initialValues:{name:t||""},autoComplete:"off"},n.createElement(E.Z.Item,{name:"name",rules:[{required:!0,message:`请输入${p.E0[r]}名称`}]},n.createElement(g.Z,{placeholder:`请输入${p.E0[r]}名称`})),n.createElement(E.Z.Item,null,n.createElement(y.ZP,{type:"primary",htmlType:"submit",block:!0},"保存"))))};const h=e=>{let{name:t,logo:l,pageType:r,modifyNameSuccessHander:c}=e;const s=(0,a.s0)(),[i,o]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement("div",{className:"cms-config-layout__header"},n.createElement("div",{className:"cms-config-layout__header--left"},n.createElement("span",{className:"cms-icon logo",dangerouslySetInnerHTML:{__html:l||"&#xe625;"}}),n.createElement("h1",{className:"name"},t),n.createElement("span",{className:"cms-icon edit",onClick:()=>o(!0)},"")),n.createElement("div",{className:"cms-config-layout__header--right"},n.createElement("div",{className:"preview"},n.createElement("i",{className:"cms-icon"},""),"预览"),n.createElement("div",{className:"publish"},n.createElement("i",{className:"cms-icon"},""),"发布"),n.createElement("div",{className:"preview",onClick:()=>s(-1)},n.createElement("i",{className:"cms-icon"},""),"返回"))),n.createElement(v,{name:t||"",pageType:r,open:i,onClose:()=>o(!1),modifyNameSuccessHander:c}))};var f=()=>{const e=Array.from(new Array(100).keys());return n.createElement("div",{className:"cms-config-layout__ruler"},n.createElement("div",{className:"cms-config-layout__ruler--hwrapper"},n.createElement("div",{className:"cms-config-layout__ruler--h"},n.createElement("span",{className:"ruler-h-50"},n.createElement("b",null,"50"),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null)),e.map(((e,t)=>n.createElement("span",{className:"ruler-h-50",key:t},n.createElement("b",null,50*t),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null)))))),n.createElement("div",{className:"cms-config-layout__ruler--vwrapper"},n.createElement("div",{className:"cms-config-layout__ruler--v"},n.createElement("span",{className:"ruler-h-50"},n.createElement("b",null,"50"),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null)),e.map(((e,t)=>n.createElement("span",{className:"ruler-h-50",key:t},n.createElement("b",null,50*t),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null),n.createElement("i",null)))))))};const w=e=>{let{children:t}=e;return n.createElement("div",{className:"cms-config-layout__main"},n.createElement("div",{className:"cms-config-layout__center"},n.createElement(f,null),t))};var _=l(53807),N=l(54549);var I=e=>{let{title:t,children:l,onClose:a}=e;return n.createElement("div",{className:"cms-box",style:{display:t?"flex":"none"}},n.createElement("div",{className:"cms-box__header"},n.createElement("div",{className:"name"},t),n.createElement(N.Z,{onClick:a})),n.createElement("div",{className:"cms-box__body"},l))};const x=[{icon:"&#xe652;",type:"element"},{icon:"&#xe634;",type:"widget"},{icon:"&#xe652;",type:"page"}],C=e=>{let{render:t,navs:l}=e;const[a,r]=(0,n.useState)("element"),[c,s]=(0,n.useState)([]);return(0,n.useEffect)((()=>{s((()=>x.filter((e=>l.includes(e.type))))),r(l[0])}),[l,s,r]),n.createElement("div",{className:"cms-config-layout__leftAside"},n.createElement("ul",{className:"cms-config-layout__leftAside--tabs"},c.map((e=>n.createElement("li",{className:"cms-config-layout__leftAside--tabItem "+(a===e.type?"is-active":""),onClick:()=>r(e.type),key:e.type},n.createElement(_.Z,{placement:"left",title:p.E0[e.type]},n.createElement("i",{className:"cms-icon",dangerouslySetInnerHTML:{__html:e.icon}})))))),n.createElement("div",{className:"cms-config-layout__leftAside--tabContent",style:{borderRight:a?"1px solid var(--cms-divider-color)":"none"}},n.createElement(I,{title:a?p.E0[a]:"",onClose:()=>r("")},t(a))))};var T=l(96801),b=l(41431),k=l(45795);var D=e=>{let{title:t,children:l,data:a,groupName:c="DrapDrop"}=e;return n.createElement("div",{className:"cms-drag__item",draggable:!0,onDragStart:e=>{r.set(c,a)},onDragEnd:e=>{r.remove(c)}},n.createElement("div",{className:"cms-drag__item--body"},l),n.createElement("div",{className:"cms-drag__item--footer"},t))};const M=["text","image","table","line","bar","pie"],S=()=>{var e,t;const[l,a]=(0,n.useState)("text"),{getElements:r,elementsList:c,elementsLoading:s}=(0,T.Rm)();return(0,n.useEffect)((()=>{r()}),[r]),n.createElement("div",{className:"cms-config-layout__elements"},n.createElement("ul",{className:"cms-config-layout__elements--left"},M.map((e=>n.createElement("div",{key:e,className:l===e?"is-active":"",onClick:()=>a(e)},p.JN[e])))),n.createElement("div",{className:"cms-config-layout__elements--right"},null===(e=c.filter((e=>e.type===l)))||void 0===e?void 0:e.map((e=>n.createElement(D,{title:e.name,data:e,groupName:"elements",key:e.id},n.createElement(b.Z,{width:224,height:120,src:e.url,preview:!1})))),!s&&!(null!==(t=c.filter((e=>e.type===l)))&&void 0!==t&&t.length)&&n.createElement(k.Z,{image:k.Z.PRESENTED_IMAGE_SIMPLE})))},L=[{icon:"&#xe63c;",type:"layer"},{icon:"&#xe652;",type:"element"},{icon:"&#xe634;",type:"widget"},{icon:"&#xe652;",type:"page"},{icon:"&#xe652;",type:"linkage"}],R=e=>{let{render:t,navs:l}=e;const[a,r]=(0,n.useState)("element"),[c,s]=(0,n.useState)([]);return(0,n.useEffect)((()=>{s((()=>L.filter((e=>l.includes(e.type))))),r(l[0])}),[l,s,r]),n.createElement("div",{className:"cms-config-layout__rightAside"},n.createElement("div",{className:"cms-config-layout__rightAside--tabContent",style:{borderLeft:a?"1px solid var(--cms-divider-color)":"none"}},n.createElement(I,{title:""+(a?p.E0[a]+"配置":""),onClose:()=>r("")},t(a))),n.createElement("ul",{className:"cms-config-layout__rightAside--tabs"},c.map((e=>n.createElement("li",{className:"cms-config-layout__rightAside--tabItem "+(a===e.type?"is-active":""),onClick:()=>r(e.type),key:e.type},n.createElement(_.Z,{placement:"left",title:`${p.E0[e.type]}配置`},n.createElement("i",{className:"cms-icon",dangerouslySetInnerHTML:{__html:e.icon}})))))))};var H=l(91816),A=l(63258);const $=e=>{let{datas:t,widgetId:l,elementId:a,onSelected:r}=e;return n.createElement("div",{className:"cms-config-layout__layer"},t.map(((e,t)=>n.createElement("div",{key:e.widgetId||t,className:"cms-config-layout__layer--item"},n.createElement("div",{className:"name "+(l===e.widgetId?"is-active":""),onClick:()=>r(e.widgetId)},n.createElement(H.Z,null)," ",e.name),n.createElement("div",{className:"content"},e.elements.map((t=>n.createElement("div",{key:t.elementId,className:""+(a===t.elementId?"is-active":""),onClick:()=>r(e.widgetId,t.elementId)},n.createElement(A.Z,null)," ",t.name))))))))};var B=e=>{let{header:t,body:l}=e;return n.createElement("div",{className:"cms-widget"},n.createElement("div",{className:"cms-widget__header"},t),n.createElement("div",{className:"cms-widget__body"},l))},F=l(19466);var Y=()=>{let e=(0,a.TH)();const[t,l]=(0,n.useReducer)(F.widgetReducer,F.initialState);(0,n.useEffect)((()=>{new URLSearchParams(e.search).size||l({type:"WIDGET",data:{name:"未命名微件",url:"",id:"",createTime:"",type:"text",count:0,x:0,y:0,column:1,row:1,widgetId:(0,s.M8)(),configuration:{},elements:[]}})}),[e]);const r=(e,t,n)=>{l(t?{type:"ADD_ELEMENT",data:{...n,position:e}}:{type:"MODIFY_ELEMENT",data:{...n,position:e}})},c=(0,n.useCallback)((e=>{l({type:"MODIFY_ELEMENT",data:{...e}})}),[]),i=(0,n.useCallback)((e=>{console.log(e,"onCloseHander"),l({type:"DELETE_ELEMENT",id:e})}),[]),d=(0,n.useCallback)((e=>e.element&&m[(0,s.fm)(e.element)]?n.createElement(m[(0,s.fm)(e.element)],{options:e.configureValue}):n.createElement("div",null,"你访问的组件不存在请联系售后人员")),[]),u=(0,n.useMemo)((()=>{let e=[];return e=null!=t&&t.widgetId?null!=t&&t.elementId?["layer","element","widget","linkage"]:["layer","widget","linkage"]:["layer","linkage"],e}),[null==t?void 0:t.elementId,null==t?void 0:t.widgetId]),E=(0,n.useCallback)(((e,n)=>{n&&(null==t?void 0:t.elementId)!==n&&l({type:"SELECT_ELEMENT",id:n})}),[null==t?void 0:t.elementId]);return n.createElement("div",{className:"cms-config-layout"},n.createElement(h,{name:null==t?void 0:t.widget.name,pageType:"widget",modifyNameSuccessHander:e=>{l({type:"MODIFY_WIDGET",data:{name:e}})}}),n.createElement("div",{className:"cms-config-layout__content"},n.createElement(C,{navs:["element"],render:e=>"element"===e?n.createElement(S,null):null}),n.createElement(w,null,n.createElement(B,{header:n.createElement(o,{column:8,row:1,gap:4,groupName:"elements",field:"elementId",datas:(null==t?void 0:t.widget.elements.filter((e=>"header"===e.position)))||[],onDropHandler:(e,t)=>r("header",e,t),onResizeEndHandler:c,onCloseHander:i,renderPreview:d}),body:n.createElement(o,{column:8,row:8,gap:4,groupName:"elements",field:"elementId",datas:(null==t?void 0:t.widget.elements.filter((e=>"body"===e.position)))||[],onDropHandler:(e,t)=>r("body",e,t),onResizeEndHandler:c,onCloseHander:i,renderPreview:d})})),n.createElement(R,{navs:u,render:e=>"layer"===e?n.createElement($,{datas:null!=t&&t.widget?[null==t?void 0:t.widget]:[],widgetId:null==t?void 0:t.widgetId,elementId:null==t?void 0:t.elementId,onSelected:E}):n.createElement("div",null,e)})))}},19466:function(e,t,l){l.r(t),l.d(t,{initialState:function(){return r},widgetReducer:function(){return c}});var n=l(15461);var a={baseText:{code:"elementBaseText",type:"text",name:"基础文本框",configureValue:{styleDisplay:"block",styleTextShadowX:0,styleTextShadowY:0,styleTextShadowF:0,styleTextShadowC:"",styleBoxInset:!1,styleBoxShadowX:0,styleBoxShadowY:0,styleBoxShadowF:0,styleBoxShadowC:"",styleBorderStyle:"none",styleBorderWidth:0,styleBorderColor:"",styleBorderTopLeftRadius:0,styleBorderTopRightRadius:0,styleBorderBottomLeftRadius:0,styleBorderBottomRightRadius:0,styleFontSize:14,styleLetterSpacing:0,styleFontWeight:"normal",styleTextAlign:"center",styleBackgroundColor:"",styleFontFamily:"Microsoft YaHei",styleLineHeight:1,styleColor:"#fff"},coordinateValue:{left:0,top:0,width:100,height:40},dataValue:{useInterface:!1,dataType:"mock",mock:{value:"文本框"},url:"",method:"get",field:"value"}}};const r={widget:{name:"未命名微件",url:"",id:"",createTime:"",type:"text",count:0,x:0,y:0,column:1,row:1,configuration:{},elements:[],widgetId:""},elementId:void 0,widgetId:void 0},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1?arguments[1]:void 0;const l=JSON.parse(JSON.stringify(e));switch(console.log(e,t),t.type){case n.WIDGET:return l.widget=t.data,l.widgetId=t.data.widgetId,l;case n.MODIFY_WIDGET:return l.widget={...l.widget,...t.data},l;case n.ADD_ELEMENT:return l.widget.elements.push({...t.data,...a[t.data.element]}),l.elementId=t.data.elementId,l;case n.DELETE_ELEMENT:return l.widget.elements=l.widget.elements.filter((e=>e.elementId!==t.id)),t.id===l.elementId&&(l.elementId=""),l;case n.MODIFY_ELEMENT:{const e=l.widget.elements.findIndex((e=>e.elementId===t.data.elementId));return-1!==e&&(l.widget.elements[e]={...t.data},l.elementId=t.data.elementId),l}case n.SELECT_ELEMENT:return l.elementId=t.id,l;default:console.log("你访问的类型不对，请自行检查")}}},15461:function(e,t,l){l.r(t),l.d(t,{ADD_ELEMENT:function(){return r},DELETE_ELEMENT:function(){return c},MODIFY_ELEMENT:function(){return i},MODIFY_WIDGET:function(){return a},SELECT_ELEMENT:function(){return s},WIDGET:function(){return n}});const n="WIDGET",a="MODIFY_WIDGET",r="ADD_ELEMENT",c="DELETE_ELEMENT",s="SELECT_ELEMENT",i="MODIFY_ELEMENT"}}]);
//# sourceMappingURL=125.70610ed05f.chunk.js.map