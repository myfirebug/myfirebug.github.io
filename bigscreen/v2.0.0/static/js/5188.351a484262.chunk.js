"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[5188,1102,4966],{35188:function(e,n,t){t.r(n);var l=t(67294),i=t(89250),d=t(56664),a=t(61102),o=t(240),u=t(52741),r=t(45795),c=t(88581),g=t(440),p=t(53525);n.default=()=>{var e,n,t,v,E,I,s,f,m,D,w,T,_,j,y,O,V,M,C,G,h,F,L,P;let A=(0,i.TH)();const[S,W]=(0,l.useReducer)(a.projectReducer,a.initialState),[Y,R]=(0,l.useState)(!1),[N]=(0,l.useState)(!0);(0,l.useEffect)((()=>{const e=new URLSearchParams(A.search);if(e.size){e.get("projectId")}else W({type:"PROJECT",data:{name:"未命名项目",url:"",createTime:"",projectId:(0,o.M8)(),screenRatio:"4*4",pages:[],configuration:{configureValue:{...u.Qy.configureValue}}}})}),[A]);const k=(0,l.useMemo)((()=>{let e=["project"];return null!=S&&S.projectId?null!=S&&S.pageId&&(e=["layer","project"],e=null!=S&&S.widgetId?null!=S&&S.elementId?["layer","element","widget","project","data","linkage"]:["layer","widget","project","data","linkage"]:["layer","project"]):e=["layer","project"],e}),[null==S?void 0:S.elementId,null==S?void 0:S.pageId,null==S?void 0:S.projectId,null==S?void 0:S.widgetId]),J=(0,l.useCallback)(((e,n,t)=>{switch(e){case"widget":return void((null==S?void 0:S.widgetId)!==n&&W({type:"SELECT_WIDGET",widgetId:n}));case"element":return void((null==S?void 0:S.elementId)!==n&&W({type:"SELECT_ELEMENT",widgetId:t,elementId:n}))}}),[null==S?void 0:S.elementId,null==S?void 0:S.widgetId]),b=(0,l.useMemo)((()=>{var e,n;return null==S||null===(e=S.project)||void 0===e||null===(n=e.pages)||void 0===n?void 0:n.find((e=>e.pageId===(null==S?void 0:S.pageId)))}),[null==S?void 0:S.pageId,null==S||null===(e=S.project)||void 0===e?void 0:e.pages]),H=(0,l.useMemo)((()=>null==b?void 0:b.widgets.find((e=>(null==S?void 0:S.widgetId)&&e.widgetId===(null==S?void 0:S.widgetId)))),[null==b?void 0:b.widgets,null==S?void 0:S.widgetId]),x=(0,l.useMemo)((()=>{var e,n;const t=null==H||null===(e=H.configuration)||void 0===e||null===(n=e.dataValue)||void 0===n?void 0:n.params;let l=[];try{for(let e in t)l.push(e)}catch(e){}return l}),[null==H||null===(n=H.configuration)||void 0===n||null===(t=n.dataValue)||void 0===t?void 0:t.params]),U=(0,l.useMemo)((()=>null==H?void 0:H.elements.find((e=>(null==S?void 0:S.elementId)&&e.elementId===(null==S?void 0:S.elementId)))),[null==H?void 0:H.elements,null==S?void 0:S.elementId]),Z=(0,l.useCallback)(((e,n,t)=>{var l;W({type:"ADD_WIDGET",data:{...n,widgetId:(0,o.M8)(),x:e.x,y:e.y,position:t,url:"",elements:null==n||null===(l=n.elements)||void 0===l?void 0:l.map((e=>({...e,elementId:(0,o.M8)(),url:""})))}})}),[]),z=(0,l.useCallback)((e=>{W({type:"MODIFY_WIDGET",data:{x:e.x,y:e.y,widgetId:e.i}})}),[]),$=(0,l.useCallback)((e=>{W({type:"MODIFY_WIDGET",data:{row:e.w,column:e.h,widgetId:e.i}})}),[]),B=(0,l.useCallback)((e=>{W({type:"DELETE_WIDGET",id:e.widgetId})}),[]),K=(0,l.useCallback)(((e,n,t)=>{"widget"===e&&W({type:"DELETE_WIDGET",id:n})}),[]),Q=(0,l.useCallback)(((e,n,t,l)=>{"widget"===e&&W({type:"MODIFY_WIDGET",data:{name:t,widgetId:n}})}),[]);return l.createElement("div",{className:"cms-config-layout"},l.createElement(d.G6,{name:null==S||null===(v=S.project)||void 0===v?void 0:v.name,pageType:"project",modifyNameSuccessHander:e=>{W({type:"MODIFY_PROJECT",data:{name:e}})},previewHandler:()=>R(!0),publishHandler:()=>{},logo:""}),l.createElement("div",{className:"cms-config-layout__content"},l.createElement(d.Gd,{navs:null!=b&&null!==(E=b.widgets)&&void 0!==E&&E.length||!b?["widget"]:["widget","page"],render:e=>"widget"===e?l.createElement(d.zc,null):"page"===e?l.createElement(d.is,{onClick:e=>{null!=b&&b.widgets.length||W({type:"ADD_WIDGET",data:e.widgets})}}):null}),l.createElement(d.JE,{style:{position:"relative",width:`${(null==S||null===(I=S.project)||void 0===I||null===(s=I.configuration)||void 0===s||null===(f=s.configureValue)||void 0===f?void 0:f.pageConfigWidth)||1366}px`,height:`${(null==S||null===(m=S.project)||void 0===m||null===(D=m.configuration)||void 0===D||null===(w=D.configureValue)||void 0===w?void 0:w.pageConfigHeight)||768}px`,background:"var(--cms-background-color-secondary)"},id:"js_project"},null!=S&&null!==(T=S.project)&&void 0!==T&&null!==(_=T.pages)&&void 0!==_&&_.length?l.createElement(l.Fragment,null,l.createElement(c.Z,{data:(null==S?void 0:S.project)||{},configureValue:null==S||null===(j=S.project)||void 0===j||null===(y=j.configuration)||void 0===y?void 0:y.configureValue,widgets:(null==b?void 0:b.widgets)||[],selectedId:null==S?void 0:S.widgetId,onDrop:Z,isDroppable:N,isResizable:N,staticed:!N,onDragStop:z,onResizeStop:$,onClose:B}),l.createElement(g.Z,{configureValue:null==S||null===(O=S.project)||void 0===O||null===(V=O.configuration)||void 0===V?void 0:V.configureValue,datas:null==S||null===(M=S.project)||void 0===M?void 0:M.pages,selectedId:null==S?void 0:S.pageId,onChange:e=>{W({type:"MODIFY_PAGE",data:{pageId:e}})}})):l.createElement(r.Z,{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"},image:r.Z.PRESENTED_IMAGE_SIMPLE,description:"请先在右侧添加页面，才能进行后面的操作哦！"})),l.createElement(d.yO,{navs:k,render:e=>{return"layer"===e?l.createElement("div",null,l.createElement(d.TC,{datas:b?[b]:[],pageId:null==S?void 0:S.pageId,widgetId:null==S?void 0:S.widgetId,elementId:null==S?void 0:S.elementId,projectId:null==S?void 0:S.projectId,onSelected:J,pageType:"project",onDeleteHandler:K,onEditHandler:Q})):"widget"===e?l.createElement(d.hp,{configureValue:(null==H||null===(n=H.configuration)||void 0===n?void 0:n.configureValue)||{},onFinish:e=>{var n;W({type:"MODIFY_WIDGET",data:{...H,configuration:{...null==H?void 0:H.configuration,configureValue:{...null==H||null===(n=H.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"element"===e?l.createElement(d.Kp,{element:null==U?void 0:U.element,configureValue:(null==U?void 0:U.configuration.configureValue)||{},onFinish:e=>{var n;W({type:"MODIFY_ELEMENT",data:{...U,configuration:{...null==U?void 0:U.configuration,configureValue:{...null==U||null===(n=U.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"data"===e?l.createElement(d.$X,{isShowWidgetDataConfig:!0,paramFields:"form"===(null==U?void 0:U.type)?x:[],widgetDataValue:null==H||null===(t=H.configuration)||void 0===t?void 0:t.dataValue,widgetOnFinish:e=>{var n;W({type:"MODIFY_WIDGET",data:{...H,configuration:{...null==H?void 0:H.configuration,dataValue:{...null==H||null===(n=H.configuration)||void 0===n?void 0:n.dataValue,...e}}}})},elementDataValue:null==U?void 0:U.configuration.dataValue,elementOnFinish:e=>{var n;W({type:"MODIFY_ELEMENT",data:{...U,configuration:{...null==U?void 0:U.configuration,dataValue:{...null==U||null===(n=U.configuration)||void 0===n?void 0:n.dataValue,...e}}}})}}):"page"===e?l.createElement(d.JB,{configureValue:null==b||null===(i=b.configuration)||void 0===i?void 0:i.configureValue,onFinish:e=>{}}):"project"===e?l.createElement(d.S5,{configureValue:null==S||null===(a=S.project)||void 0===a||null===(r=a.configuration)||void 0===r?void 0:r.configureValue,pages:(null==S||null===(c=S.project)||void 0===c?void 0:c.pages)||[],pageId:null==S?void 0:S.pageId,onFinish:e=>{W({type:"MODIFY_PROJECT_CONFIGUREVALUE",data:e})},modifyPageHandler:e=>{W({type:"MODIFY_PAGE",data:e})},addPageHandler:e=>{W({type:"ADD_PAGE",data:{name:e,id:"",url:"",createTime:"",count:0,pageId:(0,o.M8)(),screenRatio:"4*4",widgets:[],configuration:{configureValue:{...u.MP.configureValue}}}})},selectPageHandler:e=>{W({type:"SELECT_PAGE",pageId:e})},deletePageHandler:e=>{W({type:"DELETE_PAGE",pageId:e})}}):"linkage"===e?l.createElement(d.vD,{widgets:(null==b?void 0:b.widgets)||[],currentWidgetId:(null==H?void 0:H.widgetId)||"",onFinish:e=>{var n;W({type:"MODIFY_WIDGET",data:{...H,configuration:{...null==H?void 0:H.configuration,dataValue:{...null==H||null===(n=H.configuration)||void 0===n?void 0:n.dataValue,...e}}}})}}):l.createElement("div",null,e);var n,t,i,a,r,c}})),l.createElement(p.Z,{data:null==S?void 0:S.project,pageType:"project",title:"项目预览",open:Y,onClose:()=>R(!1),width:(null==S||null===(C=S.project)||void 0===C||null===(G=C.configuration)||void 0===G||null===(h=G.configureValue)||void 0===h?void 0:h.widgetConfigWidth)||1366,height:(null==S||null===(F=S.project)||void 0===F||null===(L=F.configuration)||void 0===L||null===(P=L.configureValue)||void 0===P?void 0:P.widgetConfigHeight)||768}))}},61102:function(e,n,t){t.r(n),t.d(n,{initialState:function(){return d},projectReducer:function(){return a}});var l=t(94966),i=t(240);const d={project:{name:"未命名项目",createTime:"",url:"",projectId:"",configuration:{},pages:[],screenRatio:""},elementId:void 0,widgetId:void 0,pageId:void 0,projectId:void 0},a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=arguments.length>1?arguments[1]:void 0;const t=JSON.parse(JSON.stringify(e));let a=t.project.pages.find((e=>e.pageId===t.pageId)),o=null==a?void 0:a.widgets.find((e=>e.widgetId===t.widgetId));switch(n.type){case l.PROJECT:var u;return t.project=n.data,t.pageId=null===(u=n.data.pages[0])||void 0===u?void 0:u.pageId,t.projectId=n.data.projectId,t;case l.MODIFY_PROJECT:return t.project={...t.project,...n.data},t;case l.MODIFY_PROJECT_CONFIGUREVALUE:{var r;let e=(0,i.mL)(n.data,"widget");if("{}"!==JSON.stringify(e))for(let n=0;n<t.project.pages.length;n++)for(let l=0;l<t.project.pages[n].widgets.length;l++){var c;t.project.pages[n].widgets[l].configuration={...t.project.pages[n].widgets[l].configuration,configureValue:{...null===(c=t.project.pages[n].widgets[l].configuration)||void 0===c?void 0:c.configureValue,...e}}}return t.project.configuration={...t.project.configuration,configureValue:{...null===(r=t.project.configuration)||void 0===r?void 0:r.configureValue,...n.data}},t}case l.ADD_WIDGET:{var g,p;let e=(0,i.mL)((null==t||null===(g=t.project)||void 0===g||null===(p=g.configuration)||void 0===p?void 0:p.configureValue)||{},"widget"),l=[];var v,E,I;if(Array.isArray(n.data))l=n.data.map((n=>{var t;return{...n,configuration:{...null==n?void 0:n.configuration,configureValue:{...null==n||null===(t=n.configuration)||void 0===t?void 0:t.configureValue,...e}}}}));else t.widgetId=n.data.widgetId,l.push({...n.data,configuration:{...null==n||null===(v=n.data)||void 0===v?void 0:v.configuration,configureValue:{...null==n||null===(E=n.data)||void 0===E||null===(I=E.configuration)||void 0===I?void 0:I.configureValue,...e}}});return a.widgets=a.widgets.concat(l),t.elementId="",t}case l.DELETE_WIDGET:return a.widgets=a.widgets.filter((e=>e.widgetId!==n.id)),n.id===t.widgetId&&(t.widgetId="",t.elementId=""),t;case l.MODIFY_WIDGET:{const e=a.widgets.findIndex((e=>e.widgetId===n.data.widgetId));return-1!==e&&(a.widgets[e]={...a.widgets[e],...n.data}),t}case l.SELECT_WIDGET:return t.widgetId=n.widgetId,t.elementId="",t;case l.SELECT_ELEMENT:return t.widgetId=n.widgetId,t.elementId=n.elementId,t;case l.ADD_PAGE:return t.project.pages.push(n.data),t.pageId=n.data.pageId,t.elementId="",t.widgetId="",t;case l.MODIFY_PAGE:{var s,f;const e=null==t||null===(s=t.project)||void 0===s||null===(f=s.pages)||void 0===f?void 0:f.findIndex((e=>e.pageId===n.data.pageId));return-1!==e&&(t.project.pages[e]={...t.project.pages[e],...n.data},t.pageId!==n.data.pageId&&(t.pageId=n.data.pageId,t.widgetId="",t.elementId="")),t}case l.SELECT_PAGE:return t.pageId=n.pageId,t.widgetId="",t.elementId="",t;case l.DELETE_PAGE:var m;return t.project.pages=(null===(m=t.project.pages)||void 0===m?void 0:m.filter((e=>e.pageId!==n.pageId)))||[],t.pageId===n.pageId&&(t.pageId="",t.widgetId="",t.elementId=""),t;case l.MODIFY_ELEMENT:{var D;const e=null==o||null===(D=o.elements)||void 0===D?void 0:D.findIndex((e=>e.elementId===t.elementId));return-1!==e&&((null==o?void 0:o.elements)[e]={...(null==o?void 0:o.elements)[e],...n.data}),t}}}},94966:function(e,n,t){t.r(n),t.d(n,{ADD_PAGE:function(){return g},ADD_WIDGET:function(){return a},DELETE_PAGE:function(){return E},DELETE_WIDGET:function(){return o},MODIFY_ELEMENT:function(){return I},MODIFY_PAGE:function(){return p},MODIFY_PROJECT:function(){return i},MODIFY_PROJECT_CONFIGUREVALUE:function(){return d},MODIFY_WIDGET:function(){return u},PROJECT:function(){return l},SELECT_ELEMENT:function(){return c},SELECT_PAGE:function(){return v},SELECT_WIDGET:function(){return r}});const l="PROJECT",i="MODIFY_PROJECT",d="MODIFY_PROJECT_CONFIGUREVALUE",a="ADD_WIDGET",o="DELETE_WIDGET",u="MODIFY_WIDGET",r="SELECT_WIDGET",c="SELECT_ELEMENT",g="ADD_PAGE",p="MODIFY_PAGE",v="SELECT_PAGE",E="DELETE_PAGE",I="MODIFY_ELEMENT"}}]);
//# sourceMappingURL=5188.351a484262.chunk.js.map