"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[5465],{538:function(e,l,t){var n=t(67294),a=t(2639),i=t(5676),o=t(240),d=t(83309),u=t(75735),r=t(72389);l.Z=e=>{let{open:l,onClose:t,data:c}=e;const m=(0,n.useCallback)((e=>{var l,t,a,i;return e.element&&u.Z[(0,o.fm)(e.element)]?n.createElement(u.Z[(0,o.fm)(e.element)],{options:e.configuration.configureValue,data:null===(l=e.configuration)||void 0===l||null===(t=l.dataValue)||void 0===t?void 0:t.mock,field:null===(a=e.configuration)||void 0===a||null===(i=a.dataValue)||void 0===i?void 0:i.field}):n.createElement("div",null,"你访问的组件不存在请联系售后人员")}),[]);return n.createElement(a.Z,{open:l,onClose:t,onCancel:t,footer:null,title:"微件预览",destroyOnClose:!0,width:630},n.createElement(i.Z,{data:c,style:{width:"600px",height:"400px"},header:n.createElement(r.Z,{datas:(null==c?void 0:c.elements.filter((e=>"header"===e.position)))||[],isDroppable:!1,isResizable:!1,column:d.yt,row:d.GK,gap:d.gq,render:m,staticed:!0}),body:n.createElement(r.Z,{datas:(null==c?void 0:c.elements.filter((e=>"body"===e.position)))||[],isDroppable:!1,isResizable:!1,column:d.UK,row:d.XR,gap:d.hU,render:m,staticed:!0})}))}},95465:function(e,l,t){t.r(l);var n=t(67294),a=t(89250),i=t(75735),o=t(4214),d=t(30076),u=t(5676),r=t(4221),c=t(240),m=t(83309),s=t(538),g=t(69483),v=t.n(g),f=t(46020),E=t.n(f),p=t(24404),y=t(2639),w=t(48093),I=t(34041),h=t(34002),b=t(72389);l.default=()=>{var e,l,t,g,f,D;let V=(0,a.TH)();const C=(0,a.s0)(),[T,Z]=(0,n.useReducer)(r.widgetReducer,r.initialState),[M,S]=(0,n.useState)(!1),[_,k]=(0,n.useState)(!0);(0,n.useEffect)((()=>{const e=new URLSearchParams(V.search);if(e.size){const l=e.get("widgetId");l&&v().getItem(m.mv,((e,t)=>{if(t){const e=t.find((e=>e.widgetId===l));e&&Z({type:"WIDGET",data:e})}}))}else Z({type:"WIDGET",data:{name:"未命名微件",url:"",id:"",createTime:"",type:"text",count:0,x:0,y:0,column:1,row:1,widgetId:(0,c.M8)(),configuration:{configureValue:d.X3.configureValue,dataValue:d.X3.dataValue},elements:[]}})}),[V]);const N=(0,n.useCallback)((e=>{Z({type:"MODIFY_ELEMENT",data:{x:e.x,y:e.y,elementId:e.i}})}),[]),O=(0,n.useCallback)((e=>{Z({type:"MODIFY_ELEMENT",data:{row:e.w,column:e.h,elementId:e.i}})}),[]),F=(0,n.useCallback)(((e,l,t)=>{Z({type:"ADD_ELEMENT",data:{...l,x:e.x,y:e.y,position:t,elementId:(0,c.M8)()}})}),[]),x=(0,n.useCallback)((e=>{var l,t,a,d;return e.element&&i.Z[(0,c.fm)(e.element)]?n.createElement(n.Fragment,null,(null==T?void 0:T.elementId)===e.elementId&&"element"===(null==T?void 0:T.selectedType)?n.createElement(o.k1,null):null,n.createElement(i.Z[(0,c.fm)(e.element)],{options:e.configuration.configureValue,data:null===(l=e.configuration)||void 0===l||null===(t=l.dataValue)||void 0===t?void 0:t.mock,field:null===(a=e.configuration)||void 0===a||null===(d=a.dataValue)||void 0===d?void 0:d.field})):n.createElement("div",null,"你访问的组件不存在请联系售后人员")}),[null==T?void 0:T.elementId,null==T?void 0:T.selectedType]),R=(0,n.useMemo)((()=>{let e=[];return e=null!=T&&T.widgetId?null!=T&&T.elementId?["layer","element","widget","data"]:["layer","widget","data"]:["layer","widget"],e}),[null==T?void 0:T.elementId,null==T?void 0:T.widgetId]),L=(0,n.useCallback)(((e,l)=>{"element"===e&&l&&(null==T?void 0:T.elementId)!==l&&Z({type:"SELECT_ELEMENT",id:l})}),[null==T?void 0:T.elementId]),G=(0,n.useMemo)((()=>{let e=[];for(let l in m.JN)e.push({label:m.JN[l],value:l});return e}),[]),J=(0,n.useMemo)((()=>null==T?void 0:T.widget),[null==T?void 0:T.widget]),Y=(0,n.useMemo)((()=>null==J?void 0:J.elements.find((e=>e.elementId===(null==T?void 0:T.elementId)))),[null==T?void 0:T.elementId,J]),z=(0,n.useCallback)((e=>{Z({type:"SELECTED_TYPE",data:e})}),[]),W=(0,n.useCallback)((e=>{Z({type:"DELETE_ELEMENT",id:e.elementId})}),[]);return n.createElement("div",{className:"cms-config-layout"},n.createElement(o.G6,{logo:"",name:null==T?void 0:T.widget.name,pageType:"widget",modifyNameSuccessHander:e=>{Z({type:"MODIFY_WIDGET",data:{name:e}})},previewHandler:()=>S(!0),publishHandler:()=>{k(!1),setTimeout((()=>{E()(document.getElementById("js_widget"),{allowTaint:!0,scale:.5,backgroundColor:"rgb(9, 5, 72)"}).then((e=>{try{Z({type:"MODIFY_WIDGET",data:{url:null==e?void 0:e.toDataURL()}})}catch(e){p.ZP.error("存在跨域资源，缩略图获取失败")}}))}),10)}}),n.createElement("div",{className:"cms-config-layout__content"},n.createElement(o.Gd,{navs:["element"],render:e=>"element"===e?n.createElement(o.My,null):null}),n.createElement(o.JE,null,n.createElement("div",{style:{position:"relative",width:`${(null==J||null===(e=J.configuration)||void 0===e||null===(l=e.configureValue)||void 0===l?void 0:l.widgetConfigWidth)||600}px`,height:`${(null==J||null===(t=J.configuration)||void 0===t||null===(g=t.configureValue)||void 0===g?void 0:g.widgetConfigHeight)||400}px`},id:"js_widget"},n.createElement(u.Z,{header:n.createElement(b.Z,{column:m.yt,row:m.GK,gap:m.gq,datas:(null==J?void 0:J.elements.filter((e=>"header"===e.position)))||[],render:x,onDrop:(e,l)=>F(e,l,"header"),onDragStop:N,onResizeStop:O,isDroppable:_,isResizable:_,staticed:!_,onClose:W}),body:n.createElement(b.Z,{column:m.UK,row:m.XR,gap:m.hU,datas:(null==J?void 0:J.elements.filter((e=>"body"===e.position)))||[],render:x,onDrop:(e,l)=>F(e,l,"body"),onDragStop:N,onResizeStop:O,isDroppable:_,isResizable:_,staticed:!_,onClose:W}),data:(null==T?void 0:T.widget)||{}}))),n.createElement(o.yO,{navs:R,render:e=>{return"layer"===e?n.createElement(o.TC,{datas:null!=T&&T.widget?[null==T?void 0:T.widget]:[],widgetId:null==T?void 0:T.widgetId,elementId:null==T?void 0:T.elementId,onSelected:L}):"widget"===e?n.createElement(o.hp,{configureValue:(null==T||null===(l=T.widget)||void 0===l||null===(t=l.configuration)||void 0===t?void 0:t.configureValue)||{},onFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==T||null===(l=T.widget)||void 0===l?void 0:l.configuration));Z({type:"MODIFY_WIDGET",data:{configuration:{...t,configureValue:{...t.configureValue,...e}}}})}}):"element"===e?n.createElement(o.Kp,{element:null==Y?void 0:Y.element,configureValue:(null==Y?void 0:Y.configuration.configureValue)||{},onFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==T||null===(l=T.widget)||void 0===l?void 0:l.elements.find((e=>e.elementId===T.elementId))));t&&Z({type:"MODIFY_ELEMENT",data:{...t,configuration:{...t.configuration,configureValue:{...t.configuration.configureValue,...e}}}})}}):"data"===e?n.createElement(o.$X,{widgetDataValue:null==T||null===(a=T.widget)||void 0===a||null===(i=a.configuration)||void 0===i?void 0:i.dataValue,widgetOnFinish:e=>{var l;const t=null==T?void 0:T.widget;Z({type:"MODIFY_WIDGET",data:{...t,configuration:{...null==t?void 0:t.configuration,dataValue:{...null==t||null===(l=t.configuration)||void 0===l?void 0:l.dataValue,...e}}}})},elementDataValue:null==Y?void 0:Y.configuration.dataValue,elementOnFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==T||null===(l=T.widget)||void 0===l?void 0:l.elements.find((e=>e.elementId===T.elementId))));t&&Z({type:"MODIFY_ELEMENT",data:{...t,configuration:{...t.configuration,dataValue:{...t.configuration.dataValue,...e}}}})}}):n.createElement("div",null,e);var l,t,a,i},onChange:z})),n.createElement(s.Z,{open:M,onClose:()=>S(!1),data:null==T?void 0:T.widget}),n.createElement(y.Z,{open:!_,title:"发布微件",footer:null,width:400,maskClosable:!1,onCancel:()=>k(!0)},n.createElement(w.Z,{autoComplete:"off",initialValues:null==T?void 0:T.widget,labelCol:{flex:"60px"},onFinish:e=>{p.ZP.success("发布成功"),C(-1)}},n.createElement(w.Z.Item,{name:"name",label:"微件名称"},n.createElement(w.Z.Item,{noStyle:!0},null==T||null===(f=T.widget)||void 0===f?void 0:f.name)),n.createElement(w.Z.Item,{name:"url",label:"缩略图"},n.createElement(w.Z.Item,{noStyle:!0},n.createElement("img",{src:null==T||null===(D=T.widget)||void 0===D?void 0:D.url,alt:"缩略图",style:{borderRadius:"5px",width:"100%"}}))),n.createElement(w.Z.Item,{name:"type",label:"类型",rules:[{required:!0,message:"请选择类型"}]},n.createElement(I.default,{showSearch:!0,placeholder:"请选择类型",options:G})),n.createElement(w.Z.Item,null,n.createElement(h.ZP,{type:"primary",htmlType:"submit",block:!0},"发布")))))}}}]);
//# sourceMappingURL=5465.eed83e6367.chunk.js.map