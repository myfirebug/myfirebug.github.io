"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[9118],{538:function(e,l,t){var n=t(67294),a=t(2639),o=t(5676),i=t(240),r=t(83309),d=t(75735),u=t(72389);l.Z=e=>{var l,t,s,c,g,m,v,f;let{open:p,onClose:h,data:w}=e;const y=(0,n.useCallback)((e=>{var l,t,a,o;return e.element&&d.Z[(0,i.fm)(e.element)]?n.createElement(d.Z[(0,i.fm)(e.element)],{options:e.configuration.configureValue,data:null===(l=e.configuration)||void 0===l||null===(t=l.dataValue)||void 0===t?void 0:t.mock,field:null===(a=e.configuration)||void 0===a||null===(o=a.dataValue)||void 0===o?void 0:o.field}):n.createElement("div",null,"你访问的组件不存在请联系售后人员")}),[]);return n.createElement(a.Z,{open:p,onClose:h,onCancel:h,footer:null,title:"微件预览",destroyOnClose:!0,width:null!=w&&null!==(l=w.configuration)&&void 0!==l&&null!==(t=l.configureValue)&&void 0!==t&&t.widgetConfigWidth?(null==w||null===(s=w.configuration)||void 0===s||null===(c=s.configureValue)||void 0===c?void 0:c.widgetConfigWidth)+30:630},n.createElement(o.Z,{data:w,style:{width:`${(null==w||null===(g=w.configuration)||void 0===g||null===(m=g.configureValue)||void 0===m?void 0:m.widgetConfigWidth)||600}px`,height:`${(null==w||null===(v=w.configuration)||void 0===v||null===(f=v.configureValue)||void 0===f?void 0:f.widgetConfigHeight)||400}px`},header:n.createElement(u.Z,{datas:(null==w?void 0:w.elements.filter((e=>"header"===e.position)))||[],isDroppable:!1,isResizable:!1,column:r.yt,row:r.GK,gap:r.gq,render:y,staticed:!0}),body:n.createElement(u.Z,{datas:(null==w?void 0:w.elements.filter((e=>"body"===e.position)))||[],isDroppable:!1,isResizable:!1,column:r.UK,row:r.XR,gap:r.hU,render:y,staticed:!0})}))}},9118:function(e,l,t){t.r(l),t.d(l,{default:function(){return x}});var n=t(67294),a=t(89250),o=t(89880);var i=e=>{let{width:l=0,height:t=0,gap:a=0,column:i=0,row:r=0,x:d=0,y:u=0,style:s,children:c}=e;const g=(0,n.useMemo)((()=>(0,o._i)(l,t,d,u,a,i,r)),[i,a,t,r,l,d,u]);return n.createElement("div",{className:"cms-drag__moveMask",style:{...g,...s}},c)},r=t(240);var d=(0,n.memo)((e=>{const{data:l,style:t,groupName:a,onResizeStart:i,onResizeing:r,onResizeEnd:d,onCloseHander:u,children:s,isShowCloseBtn:c}=e,[g,m]=(0,n.useState)(!1),[v,f]=(0,n.useState)(!1),p=(0,n.useMemo)((()=>({gridArea:`${l.y} / ${l.x} / ${l.y+l.row}/ ${l.x+l.column}`,...g?{opacity:0,transform:"translate(-999999999px, -9999999999px)"}:{},...v?{opacity:.5}:{}})),[l.column,l.row,l.x,l.y,g,v]),h=(0,n.useCallback)((e=>{o.Ao.set(a,{...l,pageX:e.pageX,pageY:e.pageY}),setTimeout((()=>{m(!0)}),0),f(!1)}),[l,a]),w=(0,n.useCallback)((e=>{m(!1),o.Ao.remove(a)}),[a]),y=(0,n.useCallback)((e=>{o.Ao.set(a,l),f(!0),null==i||i()}),[l,a,i]),E=(0,n.useCallback)((e=>{e.preventDefault(),null==r||r(e)}),[r]),C=(0,n.useCallback)((e=>{null==d||d(),e.target.style.width="100%",e.target.style.height="100%",f(!1)}),[d]);return n.createElement("div",{className:"cms-drag__preview--item",style:{...p,...t},onDragStart:h,draggable:!0,onDragEnd:w,onMouseDown:y,onMouseMove:E,onMouseUp:C},s,c?n.createElement("div",{className:"close",onClick:e=>{e.preventDefault(),null==u||u(l.elementId)}}):"none")}));var u=(0,n.memo)((e=>{const{groupName:l,column:t,row:a,gap:u,mask:s=!0,field:c="id",onDropHandler:g,datas:m,onResizeEndHandler:v,onCloseHander:f,renderPreview:p,auxiliaryLineConfig:h}=e,w=(0,n.useRef)(null),[y,E]=(0,n.useState)({width:0,height:0,x:0,y:0}),[C,b]=(0,n.useState)(!1),[I,k]=(0,n.useState)({}),D=(0,n.useCallback)((()=>{var e;if(!w.current)return;const{width:l,height:n,x:o,y:i}=null===(e=w.current)||void 0===e?void 0:e.getBoundingClientRect();E({width:(l-(t-1)*u)/t,height:(n-(a-1)*u)/a,x:o,y:i})}),[t,u,a]);(0,n.useEffect)((()=>{D();const e=new ResizeObserver((e=>{Array.isArray(e)&&e.length&&D()}));return e.observe(w.current),()=>{e.disconnect()}}),[D]);const x=(0,n.useMemo)((()=>{const e=[I.x,I.y,I.x+I.column-1,I.y+I.row-1];return(0,o.Fp)([0,0,t,a],e)}),[t,I,a]),V=(0,n.useCallback)((e=>parseInt(String((e-y.x)/(y.width+u)))+1),[y.width,y.x,u]),S=(0,n.useCallback)((e=>parseInt(String((e-y.y)/(y.height+u)))+1),[y.height,y.y,u]),_=(0,n.useCallback)((e=>Math.max(1,Math.ceil(e/(y.width+u)))),[y.width,u]),M=(0,n.useCallback)((e=>Math.max(1,Math.ceil(e/(y.height+u)))),[y.height,u]),N=(0,n.useCallback)((e=>{e.preventDefault();const t=o.Ao.get(l);t&&k((l=>({...l,...t,x:V(e.pageX),y:S(e.pageY),show:!0})))}),[V,S,l]),T=(0,n.useCallback)((e=>{e.preventDefault();const t=o.Ao.get(l);t&&k((l=>({...l,...t,x:V(e.pageX),y:S(e.pageY),show:!0})))}),[V,S,l]),R=(0,n.useCallback)((e=>{e.preventDefault(),k((e=>({...e,show:!1,[c]:void 0})))}),[c]),Z=(0,n.useCallback)((e=>{const t=o.Ao.get(l);e.preventDefault(),k((e=>({...e,show:!1}))),x&&g&&g(!Boolean(t&&t[c]),{...t,...I,[c]:t&&t[c]?t[c]:(0,r.M8)()})}),[I,c,l,x,g]),O=(0,n.useCallback)((()=>{const e=o.Ao.get(l);e&&(b(!1),k((l=>({...l,...e,show:!0}))))}),[l]),L=(0,n.useCallback)((e=>{b(!1),k((l=>({...l,column:_(e.target.offsetWidth),row:M(e.target.offsetHeight)})))}),[_,M]),H=(0,n.useCallback)((()=>{b(!0),k((e=>({...e,show:!1})))}),[]);return(0,n.useEffect)((()=>{const e=o.Ao.get(l);C&&x&&((null==e?void 0:e.column)===I.column&&(null==e?void 0:e.row)===I.row||(null==v||v(I),b(!1)))}),[v,I,l,C,x]),n.createElement("div",{ref:w,className:"cms-drag__content",onDragEnter:N,onDragOver:T,onDragLeave:R,onDrop:Z},n.createElement("div",{className:"cms-drag__content--container",style:{display:null!=h&&h.show?"grid":"none",gap:`${u}px`,gridTemplateColumns:`repeat(${t}, ${y.width}px)`,gridTemplateRows:`repeat(${a},  ${y.height}px)`,width:"100%",height:"100%"}},new Array(t*a).fill(null).map(((e,l)=>n.createElement("div",{key:l,style:{borderColor:(null==h?void 0:h.borderColor)||"rgba(255, 255, 255, 0.2)"}})))),n.createElement("div",{className:"cms-drag__preview",style:{display:"grid",gap:`${u}px`,gridTemplateColumns:`repeat(${t}, ${y.width}px)`,gridTemplateRows:`repeat(${a},  ${y.height}px)`,width:"100%",height:"100%"}},m.map((e=>n.createElement(d,{key:e[c],data:e,groupName:l,style:{pointerEvents:I.show&&e[c]!==I[c]?"none":"all",resize:null!=h&&h.show?"both":"none"},onResizeStart:O,onResizeing:L,onResizeEnd:H,onCloseHander:f,isShowCloseBtn:null==h?void 0:h.show},null==p?void 0:p(e)))),s?n.createElement(i,{style:{display:null!=I&&I.show?"flex":"none",background:x?"var(--cms-divider-color)":"var(--cms-color-help)"},width:y.width,height:y.height,gap:u,column:null==I?void 0:I.column,row:null==I?void 0:I.row,x:null==I?void 0:I.x,y:null==I?void 0:I.y},x?"可放置":"不可放置"):null))})),s=t(75735),c=t(4214),g=t(30076);var m=e=>{let{header:l,body:t,style:a,headerStyles:o,bodyStyles:i,id:r}=e;return n.createElement("div",{className:"cms-widget",style:a,id:r},n.createElement("div",{className:"cms-widget__header",style:o},l),n.createElement("div",{className:"cms-widget__body",style:i},t))},v=t(4221),f=t(83309),p=t(538),h=t(69483),w=t.n(h),y=t(46020),E=t.n(y),C=t(24404),b=t(2639),I=t(48093),k=t(34041),D=t(34002);var x=()=>{var e,l,t,o,i,d,h,y,x,V,S,_,M,N,T,R,Z;let O=(0,a.TH)();const L=(0,a.s0)(),[H,$]=(0,n.useReducer)(v.widgetReducer,v.initialState),[F,z]=(0,n.useState)(!1),[A,W]=(0,n.useState)(!0);(0,n.useEffect)((()=>{const e=new URLSearchParams(O.search);if(e.size){const l=e.get("widgetId");l&&w().getItem(f.mv,((e,t)=>{if(t){const e=t.find((e=>e.widgetId===l));e&&$({type:"WIDGET",data:e})}}))}else $({type:"WIDGET",data:{name:"未命名微件",url:"",id:"",createTime:"",type:"text",count:0,x:0,y:0,column:1,row:1,widgetId:(0,r.M8)(),configuration:{configureValue:g.X3.configureValue,dataValue:g.X3.dataValue},elements:[]}})}),[O]);const Y=(e,l,t)=>{$(l?{type:"ADD_ELEMENT",data:{...t,position:e}}:{type:"MODIFY_ELEMENT",data:{...t,position:e}})},G=(0,n.useCallback)((e=>{$({type:"MODIFY_ELEMENT",data:{...e}})}),[]),J=(0,n.useCallback)((e=>{$({type:"DELETE_ELEMENT",id:e})}),[]),X=(0,n.useCallback)((e=>{var l,t,a,o;return e.element&&s.Z[(0,r.fm)(e.element)]?n.createElement(n.Fragment,null,(null==H?void 0:H.elementId)===e.elementId&&"element"===(null==H?void 0:H.selectedType)?n.createElement(c.k1,null):null,n.createElement(s.Z[(0,r.fm)(e.element)],{options:e.configuration.configureValue,data:null===(l=e.configuration)||void 0===l||null===(t=l.dataValue)||void 0===t?void 0:t.mock,field:null===(a=e.configuration)||void 0===a||null===(o=a.dataValue)||void 0===o?void 0:o.field})):n.createElement("div",null,"你访问的组件不存在请联系售后人员")}),[null==H?void 0:H.elementId,null==H?void 0:H.selectedType]),P=(0,n.useMemo)((()=>{let e=[];return e=null!=H&&H.widgetId?null!=H&&H.elementId?["layer","element","data"]:["layer","data"]:["layer"],e}),[null==H?void 0:H.elementId,null==H?void 0:H.widgetId]),B=(0,n.useCallback)(((e,l)=>{"element"===e&&l&&(null==H?void 0:H.elementId)!==l&&$({type:"SELECT_ELEMENT",id:l})}),[null==H?void 0:H.elementId]),U=(0,n.useMemo)((()=>{let e=[];for(let l in f.JN)e.push({label:f.JN[l],value:l});return e}),[]),K=(0,n.useMemo)((()=>null==H?void 0:H.widget.elements.find((e=>e.elementId===(null==H?void 0:H.elementId)))),[null==H?void 0:H.elementId,null==H?void 0:H.widget.elements]),q=(0,n.useCallback)((e=>{$({type:"SELECTED_TYPE",data:e})}),[]);return n.createElement("div",{className:"cms-config-layout"},n.createElement(c.G6,{logo:"",name:null==H?void 0:H.widget.name,pageType:"widget",modifyNameSuccessHander:e=>{$({type:"MODIFY_WIDGET",data:{name:e}})},previewHandler:()=>z(!0),publishHandler:()=>{W(!1),setTimeout((()=>{E()(document.getElementById("js_widget"),{allowTaint:!0,scale:.5,backgroundColor:"rgb(9, 5, 72)"}).then((e=>{try{$({type:"MODIFY_WIDGET",data:{url:null==e?void 0:e.toDataURL()}})}catch(e){C.ZP.error("存在跨域资源，缩略图获取失败")}}))}),10)}}),n.createElement("div",{className:"cms-config-layout__content"},n.createElement(c.Gd,{navs:["element"],render:e=>"element"===e?n.createElement(c.My,null):null}),n.createElement(c.JE,null,n.createElement(m,{id:"js_widget",style:(0,r.Wi)((null==H||null===(e=H.widget)||void 0===e||null===(l=e.configuration)||void 0===l?void 0:l.configureValue)||{}),headerStyles:{...(0,r.Wi)((null==H||null===(t=H.widget)||void 0===t||null===(o=t.configuration)||void 0===o?void 0:o.configureValue)||{},"headerStyle"),display:null!=H&&null!==(i=H.widget)&&void 0!==i&&null!==(d=i.configuration)&&void 0!==d&&null!==(h=d.configureValue)&&void 0!==h&&h.headerShow?"block":"none"},bodyStyles:(0,r.Wi)((null==H||null===(y=H.widget)||void 0===y||null===(x=y.configuration)||void 0===x?void 0:x.configureValue)||{},"bodyStyle"),header:n.createElement(u,{auxiliaryLineConfig:{show:A,borderColor:null==H||null===(V=H.widget)||void 0===V||null===(S=V.configuration)||void 0===S||null===(_=S.configureValue)||void 0===_?void 0:_.auxiliaryLineBorderColor},column:f.yt,row:f.GK,gap:f.gq,groupName:"elements",field:"elementId",datas:(null==H?void 0:H.widget.elements.filter((e=>"header"===e.position)))||[],onDropHandler:(e,l)=>Y("header",e,l),onResizeEndHandler:G,onCloseHander:J,renderPreview:X}),body:n.createElement(u,{auxiliaryLineConfig:{show:A,borderColor:null==H||null===(M=H.widget)||void 0===M||null===(N=M.configuration)||void 0===N||null===(T=N.configureValue)||void 0===T?void 0:T.auxiliaryLineBorderColor},column:f.UK,row:f.XR,gap:f.hU,groupName:"elements",field:"elementId",datas:(null==H?void 0:H.widget.elements.filter((e=>"body"===e.position)))||[],onDropHandler:(e,l)=>Y("body",e,l),onResizeEndHandler:G,onCloseHander:J,renderPreview:X})})),n.createElement(c.yO,{navs:P,render:e=>{return"layer"===e?n.createElement(c.TC,{datas:null!=H&&H.widget?[null==H?void 0:H.widget]:[],widgetId:null==H?void 0:H.widgetId,elementId:null==H?void 0:H.elementId,onSelected:B}):"widget"===e?n.createElement(c.hp,{configureValue:(null==H||null===(l=H.widget)||void 0===l||null===(t=l.configuration)||void 0===t?void 0:t.configureValue)||{},onFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==H||null===(l=H.widget)||void 0===l?void 0:l.configuration));$({type:"MODIFY_WIDGET",data:{configuration:{...t,configureValue:{...t.configureValue,...e}}}})}}):"element"===e?n.createElement(c.Kp,{element:null==K?void 0:K.element,configureValue:(null==K?void 0:K.configuration.configureValue)||{},onFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==H||null===(l=H.widget)||void 0===l?void 0:l.elements.find((e=>e.elementId===H.elementId))));t&&$({type:"MODIFY_ELEMENT",data:{...t,configuration:{...t.configuration,configureValue:{...t.configuration.configureValue,...e}}}})}}):"data"===e?n.createElement(c.$X,{widgetDataValue:null==H||null===(a=H.widget)||void 0===a||null===(o=a.configuration)||void 0===o?void 0:o.dataValue,widgetOnFinish:e=>{var l;const t=null==H?void 0:H.widget;$({type:"MODIFY_WIDGET",data:{...t,configuration:{...null==t?void 0:t.configuration,dataValue:{...null==t||null===(l=t.configuration)||void 0===l?void 0:l.dataValue,...e}}}})},elementDataValue:null==K?void 0:K.configuration.dataValue,elementOnFinish:e=>{var l;const t=JSON.parse(JSON.stringify(null==H||null===(l=H.widget)||void 0===l?void 0:l.elements.find((e=>e.elementId===H.elementId))));t&&$({type:"MODIFY_ELEMENT",data:{...t,configuration:{...t.configuration,dataValue:{...t.configuration.dataValue,...e}}}})}}):n.createElement("div",null,e);var l,t,a,o},onChange:q})),n.createElement(p.Z,{open:F,onClose:()=>z(!1),data:null==H?void 0:H.widget}),n.createElement(b.Z,{open:!A,title:"发布微件",footer:null,width:400,maskClosable:!1,onCancel:()=>W(!0)},n.createElement(I.Z,{autoComplete:"off",initialValues:null==H?void 0:H.widget,labelCol:{flex:"60px"},onFinish:e=>{C.ZP.success("发布成功"),L(-1)}},n.createElement(I.Z.Item,{name:"name",label:"微件名称"},n.createElement(I.Z.Item,{noStyle:!0},null==H||null===(R=H.widget)||void 0===R?void 0:R.name)),n.createElement(I.Z.Item,{name:"url",label:"缩略图"},n.createElement(I.Z.Item,{noStyle:!0},n.createElement("img",{src:null==H||null===(Z=H.widget)||void 0===Z?void 0:Z.url,alt:"缩略图",style:{borderRadius:"5px",width:"100%"}}))),n.createElement(I.Z.Item,{name:"type",label:"类型",rules:[{required:!0,message:"请选择类型"}]},n.createElement(k.default,{showSearch:!0,placeholder:"请选择类型",options:U})),n.createElement(I.Z.Item,null,n.createElement(D.ZP,{type:"primary",htmlType:"submit",block:!0},"发布")))))}}}]);
//# sourceMappingURL=9118.37f937831a.chunk.js.map