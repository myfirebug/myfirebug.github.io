{"version":3,"file":"static/js/8372.3b155954a7.chunk.js","mappings":"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","sources":["webpack://large-screen-configuration/./src/pages/web/pageList/edit/index.tsx","webpack://large-screen-configuration/./src/pages/web/pageList/edit/store/reducers.ts","webpack://large-screen-configuration/./src/pages/web/pageList/edit/store/type.ts"],"sourcesContent":["import React, {\r\n  FC,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useReducer,\r\n  useState,\r\n} from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\n\r\nimport {\r\n  ConfigLayoutHeader,\r\n  ConfigLayoutMain,\r\n  ConfigLayoutLeftAside,\r\n  ConfigLayoutRightAside,\r\n  ConfigLayoutRightAsideLayer,\r\n  ConfigLayoutLeftAsideWidget,\r\n  ConfigLayoutRightAsideWidget,\r\n  ConfigLayoutRightAsideElement,\r\n  ConfigLayoutRightAsideData,\r\n  ConfigLayoutRightAsidePage,\r\n} from \"@src/layout/configLayout\";\r\n\r\nimport \"@src/layout/configLayout/index.scss\";\r\nimport { initialState, pageReducer } from \"./store/reducers\";\r\nimport \"animate.css\";\r\nimport html2canvas from \"html2canvas\";\r\nimport { message } from \"antd\";\r\nimport { guid } from \"@src/utils\";\r\nimport { pageConfig } from \"@src/core/config/base\";\r\nimport \"./index.scss\";\r\n\r\nimport { IElement, IWidget } from \"@src/service\";\r\nimport { Layout } from \"react-grid-layout\";\r\nimport RenderPage from \"@src/compoents/renderPage\";\r\nimport PreviewDialog from \"@src/compoents/previewDialog\";\r\nimport { web } from \"@src/core/hook\";\r\n\r\ninterface IConfigLayout {}\r\n\r\nconst ConfigLayout: FC<IConfigLayout> = () => {\r\n  let location = useLocation();\r\n  const [layout, dispatch] = useReducer(pageReducer, initialState);\r\n  const [show, setShow] = useState(false);\r\n  const [isShowAuxiliaryLine, setIsShowAuxiliaryLine] = useState(true);\r\n  const navigate = useNavigate();\r\n  const { getPages, pagesList } = web();\r\n\r\n  useEffect(() => {\r\n    const queryParams = new URLSearchParams(location.search);\r\n    // 编辑\r\n    if (queryParams.size) {\r\n      if (!pagesList.length) {\r\n        getPages();\r\n      } else {\r\n        const pageId = queryParams.get(\"pageId\");\r\n        if (pageId) {\r\n          const index = pagesList.findIndex((item) => item.id === pageId);\r\n          if (index >= 0) {\r\n            dispatch({\r\n              type: \"PAGE\",\r\n              data: pagesList[index],\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      dispatch({\r\n        type: \"PAGE\",\r\n        data: {\r\n          name: \"未命名页面\",\r\n          id: \"\",\r\n          url: \"\",\r\n          createTime: \"\",\r\n          count: 0,\r\n          pageId: guid(),\r\n          screenRatio: \"4*4\",\r\n          widgets: [],\r\n          configuration: {\r\n            configureValue: { ...pageConfig.configureValue },\r\n          },\r\n        },\r\n      });\r\n    }\r\n  }, [getPages, location, pagesList]);\r\n\r\n  // 判断右侧边栏所需模块\r\n  const rightAside = useMemo(() => {\r\n    let arr: PageType[] = [];\r\n    if (layout?.pageId) {\r\n      arr = [\"layer\", \"page\"];\r\n      if (layout?.widgetId) {\r\n        if (layout?.elementId) {\r\n          arr = [\"layer\", \"element\", \"widget\", \"page\", \"data\"];\r\n        } else {\r\n          arr = [\"layer\", \"widget\", \"page\", \"data\"];\r\n        }\r\n      } else {\r\n        arr = [\"layer\", \"page\"];\r\n      }\r\n    } else {\r\n      arr = [\"layer\"];\r\n    }\r\n    return arr;\r\n  }, [layout?.elementId, layout?.pageId, layout?.widgetId]);\r\n\r\n  // 图层选择\r\n  const layerSelectedHandle = useCallback(\r\n    (\r\n      type: \"page\" | \"widget\" | \"element\" | \"project\",\r\n      id: string,\r\n      pid?: string\r\n    ) => {\r\n      switch (type) {\r\n        case \"widget\": {\r\n          if (layout?.widgetId !== id) {\r\n            dispatch({\r\n              type: \"SELECT_WIDGET\",\r\n              widgetId: id,\r\n            });\r\n          }\r\n          return;\r\n        }\r\n        case \"element\": {\r\n          if (layout?.elementId !== id) {\r\n            dispatch({\r\n              type: \"SELECT_ELEMENT\",\r\n              widgetId: pid as string,\r\n              elementId: id,\r\n            });\r\n          }\r\n          return;\r\n        }\r\n        default:\r\n      }\r\n    },\r\n    [layout?.elementId, layout?.widgetId]\r\n  );\r\n  // 当前选中的微件\r\n  const currentWidget = useMemo(() => {\r\n    return layout?.page?.widgets.find(\r\n      (item) => layout?.widgetId && item.widgetId === layout?.widgetId\r\n    );\r\n  }, [layout?.page?.widgets, layout?.widgetId]);\r\n\r\n  // 当前选中的组件\r\n  const currentElement = useMemo(() => {\r\n    return currentWidget?.elements.find(\r\n      (item) => layout?.elementId && item.elementId === layout?.elementId\r\n    );\r\n  }, [currentWidget?.elements, layout?.elementId]);\r\n\r\n  // 新增微件\r\n  const onDrop = useCallback(\r\n    (item: Layout, data: IWidget, type: \"header\" | \"body\") => {\r\n      dispatch({\r\n        type: \"ADD_WIDGET\",\r\n        data: {\r\n          ...data,\r\n          widgetId: guid(),\r\n          x: item.x,\r\n          y: item.y,\r\n          position: type,\r\n          url: \"\",\r\n          elements: data?.elements?.map((element) => ({\r\n            ...element,\r\n            elementId: guid(),\r\n            url: \"\",\r\n          })),\r\n        },\r\n      });\r\n    },\r\n    []\r\n  );\r\n  // 修改微件\r\n  const onDragStop = useCallback((item: Layout) => {\r\n    dispatch({\r\n      type: \"MODIFY_WIDGET\",\r\n      data: {\r\n        x: item.x,\r\n        y: item.y,\r\n        widgetId: item.i,\r\n      },\r\n    });\r\n  }, []);\r\n  // 改变大小\r\n  const onResizeStop = useCallback((item: Layout) => {\r\n    dispatch({\r\n      type: \"MODIFY_WIDGET\",\r\n      data: {\r\n        row: item.w,\r\n        column: item.h,\r\n        widgetId: item.i,\r\n      },\r\n    });\r\n  }, []);\r\n\r\n  // 删除微件\r\n  const onClose = useCallback((item: IAnyObject) => {\r\n    dispatch({\r\n      type: \"DELETE_WIDGET\",\r\n      id: item.widgetId,\r\n    });\r\n  }, []);\r\n\r\n  // 删除微件\r\n  const onDeleteHandler = useCallback(\r\n    (\r\n      type: \"page\" | \"widget\" | \"element\" | \"project\",\r\n      id: string,\r\n      pid?: string\r\n    ) => {\r\n      if (type === \"widget\") {\r\n        dispatch({\r\n          type: \"DELETE_WIDGET\",\r\n          id,\r\n        });\r\n      }\r\n    },\r\n    []\r\n  );\r\n  // 修改微件\r\n  const onEditHandler = useCallback(\r\n    (\r\n      type: \"page\" | \"widget\" | \"element\" | \"project\",\r\n      id: string,\r\n      name: string,\r\n      pid?: string\r\n    ) => {\r\n      if (type === \"widget\") {\r\n        dispatch({\r\n          type: \"MODIFY_WIDGET\",\r\n          data: { name, widgetId: id },\r\n        });\r\n      }\r\n    },\r\n    []\r\n  );\r\n\r\n  return (\r\n    <div className=\"cms-config-layout\">\r\n      <ConfigLayoutHeader\r\n        name={layout?.page?.name}\r\n        pageType=\"page\"\r\n        modifyNameSuccessHander={(name) => {\r\n          dispatch({\r\n            type: \"MODIFY_PAGE\",\r\n            data: {\r\n              name,\r\n            },\r\n          });\r\n        }}\r\n        previewHandler={() => setShow(true)}\r\n        publishHandler={() => {\r\n          dispatch({\r\n            type: \"SELECT_WIDGET\",\r\n            widgetId: \"\",\r\n          });\r\n          setIsShowAuxiliaryLine(false);\r\n          setTimeout(() => {\r\n            html2canvas(document.getElementById(\"js_page\") as HTMLElement, {\r\n              allowTaint: true,\r\n              scale: 0.5,\r\n              backgroundColor: \"rgb(9, 5, 72)\",\r\n            }).then((canvas) => {\r\n              try {\r\n                dispatch({\r\n                  type: \"MODIFY_PAGE\",\r\n                  data: {\r\n                    url: canvas?.toDataURL(),\r\n                  },\r\n                });\r\n                // navigate(-1);\r\n                console.log(navigate);\r\n                message.success(\"发布成功\");\r\n              } catch (e) {\r\n                message.error(\"存在跨域资源，缩略图获取失败\");\r\n              }\r\n            });\r\n          }, 10);\r\n        }}\r\n      />\r\n      <div className=\"cms-config-layout__content\">\r\n        <ConfigLayoutLeftAside\r\n          navs={[\"widget\"]}\r\n          render={(data) => {\r\n            if (data === \"widget\") {\r\n              return <ConfigLayoutLeftAsideWidget />;\r\n            }\r\n            return null;\r\n          }}\r\n        />\r\n        <ConfigLayoutMain\r\n          style={{\r\n            position: \"relative\",\r\n            width: `${\r\n              layout?.page?.configuration?.configureValue?.pageConfigWidth ||\r\n              1366\r\n            }px`,\r\n            height: `${\r\n              layout?.page?.configuration?.configureValue?.pageConfigHeight ||\r\n              768\r\n            }px`,\r\n          }}\r\n          id=\"js_page\"\r\n        >\r\n          <RenderPage\r\n            data={layout?.page || {}}\r\n            configureValue={layout?.page?.configuration?.configureValue}\r\n            widgets={layout?.page?.widgets || []}\r\n            selectedId={layout?.widgetId}\r\n            onDrop={onDrop}\r\n            isDroppable={isShowAuxiliaryLine}\r\n            isResizable={isShowAuxiliaryLine}\r\n            staticed={!isShowAuxiliaryLine}\r\n            onDragStop={onDragStop}\r\n            onResizeStop={onResizeStop}\r\n            onClose={onClose}\r\n          />\r\n        </ConfigLayoutMain>\r\n        <ConfigLayoutRightAside\r\n          navs={rightAside}\r\n          render={(data) => {\r\n            if (data === \"layer\") {\r\n              return (\r\n                <div>\r\n                  <ConfigLayoutRightAsideLayer\r\n                    datas={layout?.page ? [layout?.page] : []}\r\n                    pageId={layout?.pageId}\r\n                    widgetId={layout?.widgetId}\r\n                    elementId={layout?.elementId}\r\n                    onSelected={layerSelectedHandle}\r\n                    pageType=\"page\"\r\n                    onDeleteHandler={onDeleteHandler}\r\n                    onEditHandler={onEditHandler}\r\n                  />\r\n                </div>\r\n              );\r\n            } else if (data === \"widget\") {\r\n              return (\r\n                <ConfigLayoutRightAsideWidget\r\n                  configureValue={\r\n                    (currentWidget?.configuration\r\n                      ?.configureValue as IAnyObject) || {}\r\n                  }\r\n                  onFinish={(data: IAnyObject) => {\r\n                    dispatch({\r\n                      type: \"MODIFY_WIDGET\",\r\n                      data: {\r\n                        ...(currentWidget as IWidget),\r\n                        configuration: {\r\n                          ...currentWidget?.configuration,\r\n                          configureValue: {\r\n                            ...currentWidget?.configuration?.configureValue,\r\n                            ...data,\r\n                          },\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                />\r\n              );\r\n            } else if (data === \"element\") {\r\n              return (\r\n                <ConfigLayoutRightAsideElement\r\n                  element={currentElement?.element}\r\n                  configureValue={\r\n                    currentElement?.configuration.configureValue || {}\r\n                  }\r\n                  onFinish={(data: IAnyObject) => {\r\n                    dispatch({\r\n                      type: \"MODIFY_ELEMENT\",\r\n                      data: {\r\n                        ...(currentElement as IElement),\r\n                        configuration: {\r\n                          ...currentElement?.configuration,\r\n                          configureValue: {\r\n                            ...currentElement?.configuration?.configureValue,\r\n                            ...data,\r\n                          },\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                />\r\n              );\r\n            } else if (data === \"data\") {\r\n              return (\r\n                <ConfigLayoutRightAsideData\r\n                  isShowWidgetDataConfig\r\n                  widgetDataValue={currentWidget?.configuration?.dataValue}\r\n                  widgetOnFinish={(data: IAnyObject) => {\r\n                    dispatch({\r\n                      type: \"MODIFY_WIDGET\",\r\n                      data: {\r\n                        ...(currentWidget as IWidget),\r\n                        configuration: {\r\n                          ...currentWidget?.configuration,\r\n                          dataValue: {\r\n                            ...currentWidget?.configuration?.dataValue,\r\n                            ...data,\r\n                          },\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                  elementDataValue={currentElement?.configuration.dataValue}\r\n                  elementOnFinish={(data: IAnyObject) => {\r\n                    dispatch({\r\n                      type: \"MODIFY_ELEMENT\",\r\n                      data: {\r\n                        ...(currentElement as IElement),\r\n                        configuration: {\r\n                          ...currentElement?.configuration,\r\n                          dataValue: {\r\n                            ...currentElement?.configuration?.dataValue,\r\n                            ...data,\r\n                          },\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                />\r\n              );\r\n            } else if (data === \"page\") {\r\n              return (\r\n                <ConfigLayoutRightAsidePage\r\n                  configureValue={layout?.page?.configuration?.configureValue}\r\n                  onFinish={(data) => {\r\n                    const configuration = layout?.page?.configuration;\r\n                    dispatch({\r\n                      type: \"MODIFY_PAGE\",\r\n                      data: {\r\n                        configuration: {\r\n                          ...configuration,\r\n                          configureValue: {\r\n                            ...configuration?.configureValue,\r\n                            ...data,\r\n                          },\r\n                        },\r\n                      },\r\n                    });\r\n                  }}\r\n                />\r\n              );\r\n            }\r\n            return <div>{data}</div>;\r\n          }}\r\n        />\r\n      </div>\r\n      {/* 页面预览 */}\r\n      <PreviewDialog\r\n        title=\"页面预览\"\r\n        pageType=\"page\"\r\n        data={layout?.page}\r\n        open={show}\r\n        onClose={() => setShow(false)}\r\n        width={\r\n          layout?.page?.configuration?.configureValue?.widgetConfigWidth || 1366\r\n        }\r\n        height={\r\n          layout?.page?.configuration?.configureValue?.widgetConfigHeight || 768\r\n        }\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConfigLayout;\r\n","import { ModifyActions } from \"./action\";\r\nimport {\r\n  ALL_STATE,\r\n  PAGE,\r\n  MODIFY_PAGE,\r\n  SELECT_WIDGET,\r\n  SELECT_ELEMENT,\r\n  ADD_WIDGET,\r\n  MODIFY_WIDGET,\r\n  MODIFY_ELEMENT,\r\n  DELETE_WIDGET,\r\n} from \"./type\";\r\n\r\nexport const initialState: ALL_STATE = {\r\n  page: {\r\n    name: \"未命名页面\",\r\n    id: \"\",\r\n    createTime: \"\",\r\n    url: \"\",\r\n    count: 0,\r\n    configuration: {},\r\n    widgets: [],\r\n    pageId: \"\",\r\n    screenRatio: \"\",\r\n  },\r\n  elementId: undefined,\r\n  widgetId: undefined,\r\n  pageId: undefined,\r\n};\r\n\r\nexport const pageReducer = (state = initialState, action: ModifyActions) => {\r\n  const copy: ALL_STATE = JSON.parse(JSON.stringify(state));\r\n  switch (action.type) {\r\n    // 获取页面\r\n    case PAGE: {\r\n      copy.page = action.data;\r\n      copy.pageId = action.data.pageId;\r\n      return copy;\r\n    }\r\n    case MODIFY_PAGE: {\r\n      copy.page = {\r\n        ...state.page,\r\n        ...action.data,\r\n      };\r\n      return copy;\r\n    }\r\n    case SELECT_WIDGET: {\r\n      copy.widgetId = action.widgetId;\r\n      copy.elementId = \"\";\r\n      return copy;\r\n    }\r\n    case ADD_WIDGET: {\r\n      copy.page.widgets = [...copy.page.widgets, action.data];\r\n      copy.widgetId = action.data.widgetId;\r\n      copy.elementId = \"\";\r\n      return copy;\r\n    }\r\n    case MODIFY_WIDGET: {\r\n      const index = copy.page.widgets.findIndex(\r\n        (item) => item.widgetId === action.data.widgetId\r\n      );\r\n      if (index !== -1) {\r\n        copy.page.widgets[index] = {\r\n          ...copy.page.widgets[index],\r\n          ...action.data,\r\n        };\r\n      }\r\n      return copy;\r\n    }\r\n    case DELETE_WIDGET: {\r\n      copy.page.widgets = copy.page.widgets.filter(\r\n        (item) => item.widgetId !== action.id\r\n      );\r\n      if (action.id === copy.widgetId) {\r\n        copy.widgetId = \"\";\r\n      }\r\n      return copy;\r\n    }\r\n    case SELECT_ELEMENT: {\r\n      copy.widgetId = action.widgetId;\r\n      copy.elementId = action.elementId;\r\n      return copy;\r\n    }\r\n    case MODIFY_ELEMENT: {\r\n      const currentWidgetIndex = copy.page.widgets.findIndex(\r\n        (item) => item.widgetId === copy.widgetId\r\n      );\r\n      if (currentWidgetIndex !== -1) {\r\n        const currentElementIndex = copy.page.widgets[\r\n          currentWidgetIndex\r\n        ].elements.findIndex((item) => item.elementId === copy.elementId);\r\n        if (currentElementIndex !== -1) {\r\n          copy.page.widgets[currentWidgetIndex].elements[currentElementIndex] =\r\n            action.data;\r\n        }\r\n      }\r\n      return copy;\r\n    }\r\n    default: {\r\n      console.log(\"你访问的类型不对，请自行检查\");\r\n    }\r\n  }\r\n};\r\n","import { IPage } from \"@src/service\";\r\n\r\n// 获取页面\r\nexport const PAGE = \"PAGE\";\r\nexport type PAGE_TYPE = typeof PAGE;\r\n\r\n// 修改页面\r\nexport const MODIFY_PAGE = \"MODIFY_PAGE\";\r\nexport type MODIFY_PAGE_TYPE = typeof MODIFY_PAGE;\r\n\r\n// 选中微件\r\nexport const SELECT_WIDGET = \"SELECT_WIDGET\";\r\nexport type SELECT_WIDGET_TYPE = typeof SELECT_WIDGET;\r\n\r\n// 添加微件\r\nexport const ADD_WIDGET = \"ADD_WIDGET\";\r\nexport type ADD_WIDGET_TYPE = typeof ADD_WIDGET;\r\n\r\n// 删除微件\r\nexport const DELETE_WIDGET = \"DELETE_WIDGET\";\r\nexport type DELETE_WIDGET_TYPE = typeof DELETE_WIDGET;\r\n\r\n// 修改微件\r\nexport const MODIFY_WIDGET = \"MODIFY_WIDGET\";\r\nexport type MODIFY_WIDGET_TYPE = typeof MODIFY_WIDGET;\r\n\r\n// 选中组件\r\nexport const SELECT_ELEMENT = \"SELECT_ELEMENT\";\r\nexport type SELECT_ELEMENT_TYPE = typeof SELECT_ELEMENT;\r\n\r\n// 修改组件\r\nexport const MODIFY_ELEMENT = \"MODIFY_ELEMENT\";\r\nexport type MODIFY_ELEMENT_TYPE = typeof MODIFY_ELEMENT;\r\n\r\nexport interface ALL_STATE {\r\n  page: IPage;\r\n  elementId: string | undefined;\r\n  widgetId: string | undefined;\r\n  pageId: string | undefined;\r\n}\r\n"],"names":["ConfigLayout","_layout$page2","_layout$page3","_layout$page4","_layout$page4$configu","_layout$page4$configu2","_layout$page5","_layout$page5$configu","_layout$page5$configu2","_layout$page6","_layout$page6$configu","_layout$page7","_layout$page10","_layout$page10$config","_layout$page10$config2","_layout$page11","_layout$page11$config","_layout$page11$config2","location","useLocation","layout","dispatch","useReducer","pageReducer","initialState","show","setShow","useState","isShowAuxiliaryLine","setIsShowAuxiliaryLine","getPages","pagesList","useNavigate","web","useEffect","queryParams","URLSearchParams","search","size","length","pageId","get","index","findIndex","item","id","type","data","name","url","createTime","count","guid","screenRatio","widgets","configuration","configureValue","pageConfig","rightAside","useMemo","arr","widgetId","elementId","layerSelectedHandle","useCallback","pid","currentWidget","_layout$page","page","find","currentElement","elements","onDrop","_data$elements","x","y","position","map","element","onDragStop","i","onResizeStop","row","w","column","h","onClose","onDeleteHandler","onEditHandler","React","className","ConfigLayoutHeader","pageType","modifyNameSuccessHander","previewHandler","publishHandler","setTimeout","html2canvas","document","getElementById","allowTaint","scale","backgroundColor","then","canvas","toDataURL","message","success","e","error","ConfigLayoutLeftAside","navs","render","ConfigLayoutLeftAsideWidget","ConfigLayoutMain","style","width","pageConfigWidth","height","pageConfigHeight","RenderPage","selectedId","isDroppable","isResizable","staticed","ConfigLayoutRightAside","ConfigLayoutRightAsideLayer","datas","onSelected","ConfigLayoutRightAsideWidget","_currentWidget$config","onFinish","_currentWidget$config2","ConfigLayoutRightAsideElement","_currentElement$confi","ConfigLayoutRightAsideData","isShowWidgetDataConfig","widgetDataValue","_currentWidget$config3","dataValue","widgetOnFinish","_currentWidget$config4","elementDataValue","elementOnFinish","_currentElement$confi2","ConfigLayoutRightAsidePage","_layout$page8","_layout$page8$configu","_layout$page9","PreviewDialog","title","open","widgetConfigWidth","widgetConfigHeight","undefined","state","arguments","action","copy","JSON","parse","stringify","PAGE","MODIFY_PAGE","SELECT_WIDGET","ADD_WIDGET","MODIFY_WIDGET","DELETE_WIDGET","filter","SELECT_ELEMENT","MODIFY_ELEMENT","currentWidgetIndex","currentElementIndex"],"sourceRoot":""}