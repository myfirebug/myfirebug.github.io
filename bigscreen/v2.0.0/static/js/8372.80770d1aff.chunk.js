"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[8372,780,6739],{98372:function(e,n,t){t.r(n);var i=t(67294),l=t(89250),a=t(92957),d=t(50780),u=t(46020),o=t.n(u),g=t(24404),r=t(240),c=t(52741),E=t(83309),s=t(69483),I=t.n(s),v=t(88581),p=t(53525);n.default=()=>{var e,n,t,u,s,f,w,m,D,T,_,y,G,M,h,V,C;let L=(0,l.TH)();const[O,F]=(0,i.useReducer)(d.pageReducer,d.initialState),[W,S]=(0,i.useState)(!1),[Y,A]=(0,i.useState)(!0);(0,l.s0)();(0,i.useEffect)((()=>{const e=new URLSearchParams(L.search);if(e.size){const n=e.get("pageId");n&&I().getItem(E.Ow,((e,t)=>{if(t){const e=t.find((e=>e.pageId===n));e&&F({type:"PAGE",data:e})}}))}else F({type:"PAGE",data:{name:"未命名页面",id:"",url:"",createTime:"",count:0,pageId:(0,r.M8)(),screenRatio:"4*4",widgets:[],configuration:{configureValue:{...c.MP.configureValue}}}})}),[L]);const P=(0,i.useMemo)((()=>{let e=[];return null!=O&&O.pageId?(e=["layer","page"],e=null!=O&&O.widgetId?null!=O&&O.elementId?["layer","element","widget","page","data"]:["layer","widget","page"]:["layer","page"]):e=["layer"],e}),[null==O?void 0:O.elementId,null==O?void 0:O.pageId,null==O?void 0:O.widgetId]),b=(0,i.useCallback)(((e,n,t)=>{switch(e){case"widget":return void((null==O?void 0:O.widgetId)!==n&&F({type:"SELECT_WIDGET",widgetId:n}));case"element":return void((null==O?void 0:O.elementId)!==n&&F({type:"SELECT_ELEMENT",widgetId:t,elementId:n}))}}),[null==O?void 0:O.elementId,null==O?void 0:O.widgetId]),N=(0,i.useMemo)((()=>{var e;return null==O||null===(e=O.page)||void 0===e?void 0:e.widgets.find((e=>(null==O?void 0:O.widgetId)&&e.widgetId===(null==O?void 0:O.widgetId)))}),[null==O||null===(e=O.page)||void 0===e?void 0:e.widgets,null==O?void 0:O.widgetId]),k=(0,i.useMemo)((()=>null==N?void 0:N.elements.find((e=>(null==O?void 0:O.elementId)&&e.elementId===(null==O?void 0:O.elementId)))),[null==N?void 0:N.elements,null==O?void 0:O.elementId]),x=(0,i.useCallback)(((e,n,t)=>{var i;F({type:"ADD_WIDGET",data:{...n,widgetId:(0,r.M8)(),x:e.x,y:e.y,position:t,url:"",elements:null==n||null===(i=n.elements)||void 0===i?void 0:i.map((e=>({...e,elementId:(0,r.M8)(),url:""})))}})}),[]),R=(0,i.useCallback)((e=>{F({type:"MODIFY_WIDGET",data:{x:e.x,y:e.y,widgetId:e.i}})}),[]),H=(0,i.useCallback)((e=>{F({type:"MODIFY_WIDGET",data:{row:e.w,column:e.h,widgetId:e.i}})}),[]),z=(0,i.useCallback)((e=>{F({type:"DELETE_WIDGET",id:e.widgetId})}),[]),J=(0,i.useCallback)(((e,n,t)=>{"widget"===e&&F({type:"DELETE_WIDGET",id:n})}),[]),Z=(0,i.useCallback)(((e,n,t,i)=>{"widget"===e&&F({type:"MODIFY_WIDGET",data:{name:t,widgetId:n}})}),[]);return i.createElement("div",{className:"cms-config-layout"},i.createElement(a.G6,{name:null==O||null===(n=O.page)||void 0===n?void 0:n.name,pageType:"page",modifyNameSuccessHander:e=>{F({type:"MODIFY_PAGE",data:{name:e}})},previewHandler:()=>S(!0),publishHandler:()=>{F({type:"SELECT_WIDGET",widgetId:""}),A(!1),setTimeout((()=>{o()(document.getElementById("js_page"),{allowTaint:!0,scale:.5,backgroundColor:"rgb(9, 5, 72)"}).then((e=>{try{F({type:"MODIFY_PAGE",data:{url:null==e?void 0:e.toDataURL()}}),g.ZP.success("发布成功")}catch(e){g.ZP.error("存在跨域资源，缩略图获取失败")}}))}),10)}}),i.createElement("div",{className:"cms-config-layout__content"},i.createElement(a.Gd,{navs:["widget"],render:e=>"widget"===e?i.createElement(a.zc,null):null}),i.createElement(a.JE,{style:{position:"relative",width:`${(null==O||null===(t=O.page)||void 0===t||null===(u=t.configuration)||void 0===u||null===(s=u.configureValue)||void 0===s?void 0:s.pageConfigWidth)||1366}px`,height:`${(null==O||null===(f=O.page)||void 0===f||null===(w=f.configuration)||void 0===w||null===(m=w.configureValue)||void 0===m?void 0:m.pageConfigHeight)||768}px`},id:"js_page"},i.createElement(v.Z,{data:(null==O?void 0:O.page)||{},configureValue:null==O||null===(D=O.page)||void 0===D||null===(T=D.configuration)||void 0===T?void 0:T.configureValue,widgets:(null==O||null===(_=O.page)||void 0===_?void 0:_.widgets)||[],selectedId:null==O?void 0:O.widgetId,onDrop:x,isDroppable:Y,isResizable:Y,staticed:!Y,onDragStop:R,onResizeStop:H,onClose:z})),i.createElement(a.yO,{navs:P,render:e=>{return"layer"===e?i.createElement("div",null,i.createElement(a.TC,{datas:null!=O&&O.page?[null==O?void 0:O.page]:[],pageId:null==O?void 0:O.pageId,widgetId:null==O?void 0:O.widgetId,elementId:null==O?void 0:O.elementId,onSelected:b,pageType:"page",onDeleteHandler:J,onEditHandler:Z})):"widget"===e?i.createElement(a.hp,{configureValue:(null==N||null===(n=N.configuration)||void 0===n?void 0:n.configureValue)||{},onFinish:e=>{var n;F({type:"MODIFY_WIDGET",data:{...N,configuration:{...null==N?void 0:N.configuration,configureValue:{...null==N||null===(n=N.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"element"===e?i.createElement(a.Kp,{element:null==k?void 0:k.element,configureValue:(null==k?void 0:k.configuration.configureValue)||{},onFinish:e=>{var n;F({type:"MODIFY_ELEMENT",data:{...k,configuration:{...null==k?void 0:k.configuration,configureValue:{...null==k||null===(n=k.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"data"===e?i.createElement(a.$X,{widgetDataValue:null==N||null===(t=N.configuration)||void 0===t?void 0:t.dataValue,widgetOnFinish:e=>{var n;F({type:"MODIFY_WIDGET",data:{...N,configuration:{...null==N?void 0:N.configuration,dataValue:{...null==N||null===(n=N.configuration)||void 0===n?void 0:n.dataValue,...e}}}})},elementDataValue:null==k?void 0:k.configuration.dataValue,elementOnFinish:e=>{var n;F({type:"MODIFY_ELEMENT",data:{...k,configuration:{...null==k?void 0:k.configuration,dataValue:{...null==k||null===(n=k.configuration)||void 0===n?void 0:n.dataValue,...e}}}})}}):"page"===e?i.createElement(a.JB,{configureValue:null==O||null===(l=O.page)||void 0===l||null===(d=l.configuration)||void 0===d?void 0:d.configureValue,onFinish:e=>{var n;const t=null==O||null===(n=O.page)||void 0===n?void 0:n.configuration;F({type:"MODIFY_PAGE",data:{configuration:{...t,configureValue:{...null==t?void 0:t.configureValue,...e}}}})}}):i.createElement("div",null,e);var n,t,l,d}})),i.createElement(p.Z,{title:"页面预览",pageType:"page",data:null==O?void 0:O.page,open:W,onClose:()=>S(!1),width:(null==O||null===(y=O.page)||void 0===y||null===(G=y.configuration)||void 0===G||null===(M=G.configureValue)||void 0===M?void 0:M.widgetConfigWidth)||1366,height:(null==O||null===(h=O.page)||void 0===h||null===(V=h.configuration)||void 0===V||null===(C=V.configureValue)||void 0===C?void 0:C.widgetConfigHeight)||768}))}},50780:function(e,n,t){t.r(n),t.d(n,{initialState:function(){return l},pageReducer:function(){return a}});var i=t(86739);const l={page:{name:"未命名页面",id:"",createTime:"",url:"",count:0,configuration:{},widgets:[],pageId:"",screenRatio:""},elementId:void 0,widgetId:void 0,pageId:void 0},a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1?arguments[1]:void 0;const t=JSON.parse(JSON.stringify(e));switch(n.type){case i.PAGE:return t.page=n.data,t.pageId=n.data.pageId,t;case i.MODIFY_PAGE:return t.page={...e.page,...n.data},t;case i.SELECT_WIDGET:return t.widgetId=n.widgetId,t.elementId="",t;case i.ADD_WIDGET:return t.page.widgets=[...t.page.widgets,n.data],t.widgetId=n.data.widgetId,t.elementId="",t;case i.MODIFY_WIDGET:{const e=t.page.widgets.findIndex((e=>e.widgetId===n.data.widgetId));return-1!==e&&(t.page.widgets[e]={...t.page.widgets[e],...n.data}),t}case i.DELETE_WIDGET:return t.page.widgets=t.page.widgets.filter((e=>e.widgetId!==n.id)),n.id===t.widgetId&&(t.widgetId=""),t;case i.SELECT_ELEMENT:return t.widgetId=n.widgetId,t.elementId=n.elementId,t;case i.MODIFY_ELEMENT:{const e=t.page.widgets.findIndex((e=>e.widgetId===t.widgetId));if(-1!==e){const i=t.page.widgets[e].elements.findIndex((e=>e.elementId===t.elementId));-1!==i&&(t.page.widgets[e].elements[i]=n.data)}return t}}}},86739:function(e,n,t){t.r(n),t.d(n,{ADD_WIDGET:function(){return d},DELETE_WIDGET:function(){return u},MODIFY_ELEMENT:function(){return r},MODIFY_PAGE:function(){return l},MODIFY_WIDGET:function(){return o},PAGE:function(){return i},SELECT_ELEMENT:function(){return g},SELECT_WIDGET:function(){return a}});const i="PAGE",l="MODIFY_PAGE",a="SELECT_WIDGET",d="ADD_WIDGET",u="DELETE_WIDGET",o="MODIFY_WIDGET",g="SELECT_ELEMENT",r="MODIFY_ELEMENT"}}]);
//# sourceMappingURL=8372.80770d1aff.chunk.js.map