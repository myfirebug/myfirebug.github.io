"use strict";(self.webpackChunklarge_screen_configuration=self.webpackChunklarge_screen_configuration||[]).push([[8372,780,6739],{98372:function(e,n,t){t.r(n);var i=t(67294),l=t(89250),a=t(56664),d=t(50780),o=t(46020),u=t.n(o),g=t(24404),r=t(240),c=t(52741),s=t(88581),E=t(53525),I=t(32008);n.default=()=>{var e,n,t,o,v,p,f,w,m,D,T,_,y,G,M,h,V;let C=(0,l.TH)();const[L,W]=(0,i.useReducer)(d.pageReducer,d.initialState),[F,O]=(0,i.useState)(!1),[S,Y]=(0,i.useState)(!0),{getPages:P,pagesList:A}=((0,l.s0)(),(0,I.xw)());(0,i.useEffect)((()=>{const e=new URLSearchParams(C.search);if(e.size)if(A.length){const n=e.get("pageId");if(n){const e=A.findIndex((e=>e.id===n));e>=0&&W({type:"PAGE",data:A[e]})}}else P();else W({type:"PAGE",data:{name:"未命名页面",id:"",url:"",createTime:"",count:0,pageId:(0,r.M8)(),screenRatio:"4*4",widgets:[],configuration:{configureValue:{...c.MP.configureValue}}}})}),[P,C,A]);const b=(0,i.useMemo)((()=>{let e=[];return null!=L&&L.pageId?(e=["layer","page"],e=null!=L&&L.widgetId?null!=L&&L.elementId?["layer","element","widget","page","data"]:["layer","widget","page","data"]:["layer","page"]):e=["layer"],e}),[null==L?void 0:L.elementId,null==L?void 0:L.pageId,null==L?void 0:L.widgetId]),N=(0,i.useCallback)(((e,n,t)=>{switch(e){case"widget":return void((null==L?void 0:L.widgetId)!==n&&W({type:"SELECT_WIDGET",widgetId:n}));case"element":return void((null==L?void 0:L.elementId)!==n&&W({type:"SELECT_ELEMENT",widgetId:t,elementId:n}))}}),[null==L?void 0:L.elementId,null==L?void 0:L.widgetId]),k=(0,i.useMemo)((()=>{var e;return null==L||null===(e=L.page)||void 0===e?void 0:e.widgets.find((e=>(null==L?void 0:L.widgetId)&&e.widgetId===(null==L?void 0:L.widgetId)))}),[null==L||null===(e=L.page)||void 0===e?void 0:e.widgets,null==L?void 0:L.widgetId]),x=(0,i.useMemo)((()=>null==k?void 0:k.elements.find((e=>(null==L?void 0:L.elementId)&&e.elementId===(null==L?void 0:L.elementId)))),[null==k?void 0:k.elements,null==L?void 0:L.elementId]),R=(0,i.useCallback)(((e,n,t)=>{var i;W({type:"ADD_WIDGET",data:{...n,widgetId:(0,r.M8)(),x:e.x,y:e.y,position:t,url:"",elements:null==n||null===(i=n.elements)||void 0===i?void 0:i.map((e=>({...e,elementId:(0,r.M8)(),url:""})))}})}),[]),H=(0,i.useCallback)((e=>{W({type:"MODIFY_WIDGET",data:{x:e.x,y:e.y,widgetId:e.i}})}),[]),z=(0,i.useCallback)((e=>{W({type:"MODIFY_WIDGET",data:{row:e.w,column:e.h,widgetId:e.i}})}),[]),J=(0,i.useCallback)((e=>{W({type:"DELETE_WIDGET",id:e.widgetId})}),[]),Z=(0,i.useCallback)(((e,n,t)=>{"widget"===e&&W({type:"DELETE_WIDGET",id:n})}),[]),$=(0,i.useCallback)(((e,n,t,i)=>{"widget"===e&&W({type:"MODIFY_WIDGET",data:{name:t,widgetId:n}})}),[]);return i.createElement("div",{className:"cms-config-layout"},i.createElement(a.G6,{name:null==L||null===(n=L.page)||void 0===n?void 0:n.name,pageType:"page",modifyNameSuccessHander:e=>{W({type:"MODIFY_PAGE",data:{name:e}})},previewHandler:()=>O(!0),publishHandler:()=>{W({type:"SELECT_WIDGET",widgetId:""}),Y(!1),setTimeout((()=>{u()(document.getElementById("js_page"),{allowTaint:!0,scale:.5,backgroundColor:"rgb(9, 5, 72)"}).then((e=>{try{W({type:"MODIFY_PAGE",data:{url:null==e?void 0:e.toDataURL()}}),g.ZP.success("发布成功")}catch(e){g.ZP.error("存在跨域资源，缩略图获取失败")}}))}),10)}}),i.createElement("div",{className:"cms-config-layout__content"},i.createElement(a.Gd,{navs:["widget"],render:e=>"widget"===e?i.createElement(a.zc,null):null}),i.createElement(a.JE,{style:{position:"relative",width:`${(null==L||null===(t=L.page)||void 0===t||null===(o=t.configuration)||void 0===o||null===(v=o.configureValue)||void 0===v?void 0:v.pageConfigWidth)||1366}px`,height:`${(null==L||null===(p=L.page)||void 0===p||null===(f=p.configuration)||void 0===f||null===(w=f.configureValue)||void 0===w?void 0:w.pageConfigHeight)||768}px`},id:"js_page"},i.createElement(s.Z,{data:(null==L?void 0:L.page)||{},configureValue:null==L||null===(m=L.page)||void 0===m||null===(D=m.configuration)||void 0===D?void 0:D.configureValue,widgets:(null==L||null===(T=L.page)||void 0===T?void 0:T.widgets)||[],selectedId:null==L?void 0:L.widgetId,onDrop:R,isDroppable:S,isResizable:S,staticed:!S,onDragStop:H,onResizeStop:z,onClose:J})),i.createElement(a.yO,{navs:b,render:e=>{return"layer"===e?i.createElement("div",null,i.createElement(a.TC,{datas:null!=L&&L.page?[null==L?void 0:L.page]:[],pageId:null==L?void 0:L.pageId,widgetId:null==L?void 0:L.widgetId,elementId:null==L?void 0:L.elementId,onSelected:N,pageType:"page",onDeleteHandler:Z,onEditHandler:$})):"widget"===e?i.createElement(a.hp,{configureValue:(null==k||null===(n=k.configuration)||void 0===n?void 0:n.configureValue)||{},onFinish:e=>{var n;W({type:"MODIFY_WIDGET",data:{...k,configuration:{...null==k?void 0:k.configuration,configureValue:{...null==k||null===(n=k.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"element"===e?i.createElement(a.Kp,{element:null==x?void 0:x.element,configureValue:(null==x?void 0:x.configuration.configureValue)||{},onFinish:e=>{var n;W({type:"MODIFY_ELEMENT",data:{...x,configuration:{...null==x?void 0:x.configuration,configureValue:{...null==x||null===(n=x.configuration)||void 0===n?void 0:n.configureValue,...e}}}})}}):"data"===e?i.createElement(a.$X,{isShowWidgetDataConfig:!0,widgetDataValue:null==k||null===(t=k.configuration)||void 0===t?void 0:t.dataValue,widgetOnFinish:e=>{var n;W({type:"MODIFY_WIDGET",data:{...k,configuration:{...null==k?void 0:k.configuration,dataValue:{...null==k||null===(n=k.configuration)||void 0===n?void 0:n.dataValue,...e}}}})},elementDataValue:null==x?void 0:x.configuration.dataValue,elementOnFinish:e=>{var n;W({type:"MODIFY_ELEMENT",data:{...x,configuration:{...null==x?void 0:x.configuration,dataValue:{...null==x||null===(n=x.configuration)||void 0===n?void 0:n.dataValue,...e}}}})}}):"page"===e?i.createElement(a.JB,{configureValue:null==L||null===(l=L.page)||void 0===l||null===(d=l.configuration)||void 0===d?void 0:d.configureValue,onFinish:e=>{var n;const t=null==L||null===(n=L.page)||void 0===n?void 0:n.configuration;W({type:"MODIFY_PAGE",data:{configuration:{...t,configureValue:{...null==t?void 0:t.configureValue,...e}}}})}}):i.createElement("div",null,e);var n,t,l,d}})),i.createElement(E.Z,{title:"页面预览",pageType:"page",data:null==L?void 0:L.page,open:F,onClose:()=>O(!1),width:(null==L||null===(_=L.page)||void 0===_||null===(y=_.configuration)||void 0===y||null===(G=y.configureValue)||void 0===G?void 0:G.widgetConfigWidth)||1366,height:(null==L||null===(M=L.page)||void 0===M||null===(h=M.configuration)||void 0===h||null===(V=h.configureValue)||void 0===V?void 0:V.widgetConfigHeight)||768}))}},50780:function(e,n,t){t.r(n),t.d(n,{initialState:function(){return l},pageReducer:function(){return a}});var i=t(86739);const l={page:{name:"未命名页面",id:"",createTime:"",url:"",count:0,configuration:{},widgets:[],pageId:"",screenRatio:""},elementId:void 0,widgetId:void 0,pageId:void 0},a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1?arguments[1]:void 0;const t=JSON.parse(JSON.stringify(e));switch(n.type){case i.PAGE:return t.page=n.data,t.pageId=n.data.pageId,t;case i.MODIFY_PAGE:return t.page={...e.page,...n.data},t;case i.SELECT_WIDGET:return t.widgetId=n.widgetId,t.elementId="",t;case i.ADD_WIDGET:return t.page.widgets=[...t.page.widgets,n.data],t.widgetId=n.data.widgetId,t.elementId="",t;case i.MODIFY_WIDGET:{const e=t.page.widgets.findIndex((e=>e.widgetId===n.data.widgetId));return-1!==e&&(t.page.widgets[e]={...t.page.widgets[e],...n.data}),t}case i.DELETE_WIDGET:return t.page.widgets=t.page.widgets.filter((e=>e.widgetId!==n.id)),n.id===t.widgetId&&(t.widgetId=""),t;case i.SELECT_ELEMENT:return t.widgetId=n.widgetId,t.elementId=n.elementId,t;case i.MODIFY_ELEMENT:{const e=t.page.widgets.findIndex((e=>e.widgetId===t.widgetId));if(-1!==e){const i=t.page.widgets[e].elements.findIndex((e=>e.elementId===t.elementId));-1!==i&&(t.page.widgets[e].elements[i]=n.data)}return t}}}},86739:function(e,n,t){t.r(n),t.d(n,{ADD_WIDGET:function(){return d},DELETE_WIDGET:function(){return o},MODIFY_ELEMENT:function(){return r},MODIFY_PAGE:function(){return l},MODIFY_WIDGET:function(){return u},PAGE:function(){return i},SELECT_ELEMENT:function(){return g},SELECT_WIDGET:function(){return a}});const i="PAGE",l="MODIFY_PAGE",a="SELECT_WIDGET",d="ADD_WIDGET",o="DELETE_WIDGET",u="MODIFY_WIDGET",g="SELECT_ELEMENT",r="MODIFY_ELEMENT"}}]);
//# sourceMappingURL=8372.3b155954a7.chunk.js.map